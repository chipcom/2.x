// mo_init.prg
#include 'set.ch'
#include 'inkey.ch'
#include 'dbstruct.ch'
#include 'function.ch'
#include 'edit_spr.ch'
#include 'chip_mo.ch'

// ** 06.08.17 условное индексирование цен на услуги в 2017 году
// Function f_index_uslc()
//   if is_adres_podr
//     return (codemo == glob_mo[_MO_KOD_TFOMS] .or. codemo == glob_podr_2)
//   else
//     return (codemo == glob_mo[_MO_KOD_TFOMS])
//   endif
//   return .t.

// 28.03.23 начальная инициализация программы (до входа в Reconstruct_BD)
Function Init_first()
  Local buf := save_maxrow()

  mywait()
  // инициализировать массив DBF-файлов базы данных
  init_Array_Files_DB()
  // инициализировать все mem (public) - переменные
  Public stm_kategor2 := {}
  init_all_mem_public()
  //
  Public glob_schet_akt := 3  // 1-по всем случаям, 2-за вычетом снятий, 3-за вычетом повторно выставленных
  Public glob_schet := -2
  Public glob_perso := 0    // код по БД human
  Public glob_kartotek := 0 // код по БД kartotek
  Public glob_k_fio := ''   // глобальное ФИО
  Public glob_uch := {0, ''} // глобальное учреждение
  Public glob_otd := {0, '', 0, 0} // глобальное отделение
  Public sys1_date := sys_date
  Public c4sys_date := dtoc4(sys1_date)
  Public glob_human := {0, '', 0, 0, 0, '', 0, 0}
  Public glob_komu := 1
  Public glob_all := {0, ''}
  Public glob_strah := {0, ''}
  Public glob_komitet := {0, ''}
  Public glob_pr_vz := {0, ''}
  Public glob_d_smo := {0, ''}
  Public glob_priem := {0, ''}
  Public glob_r_mu := {0, '', ''}
  Public st_a_otd, st_a_uch, st_a_uchast
  Public glob_MGI := { ;
    {'60.9.1', 12, 26, 25}, ; // Молекулярно-генетическое исследование мутаций в генах BRCA1 и BRCA2 в крови
    {'60.9.13', 5, 12, 11}, ; // Молекулярно-генетическое исследование мутаций в гене EGFR в биопсийном (операционном) материале
    {'60.9.31', 1, 2, 1}, ; // Определение амплификации гена HER2 методом флюоресцентной гибридизации in situ (FISH)
    {'60.9.32', 1, 2, 1}, ; // Определение амплификации гена HER2 методом хромогенной гибридизации in situ (CISH)
    {'60.9.5',  4, 10, 9}, ; // Молекулярно-генетическое исследование мутаций в гене KRAS в биопсийном (операционном) материале
    {'60.9.6',  4, 10, 9}, ; // Молекулярно-генетическое исследование мутаций в гене NRAS в биопсийном (операционном) материале
    {'60.9.7',  2, 5, 4} ;  // Молекулярно-генетическое исследование мутаций в гене BRAF в биопсийном (операционном) материале
  }  // второй эл-т массива - код по справочнику N010
  // Public glob_NMIC := { ;
  // {" медицинская организация Волгограда (Волгоградской области)"               , 0},;
  // {" 1 НМИЦ онкологии им.Н.Н.Блохина"                                          , 1},;
  // {" 2 НМИЦ им.В.А.Алмазова"                                                   , 2},;
  // {" 3 НМИЦ сердечно-сосудистой хирургии им.А.Н.Бакулева"                      , 3},;
  // {" 4 НМИЦ здоровья детей"                                                    , 4},;
  // {" 5 НМИЦ акушерства, гинекологии и перинатологии им.академика В.И.Кулакова" , 5},;
  // {" 6 НМИЦ радиологии"                                                        , 6},;
  // {" 7 НМИЦ детской гематологии, онкологии и иммунологии им.Дмитрия Рогачева"  , 7},;
  // {" 8 НМИЦ психиатрии и наркологии им.В.П.Сербского"                          , 8},;
  // {" 9 НМИЦ кардиологии"                                                       , 9},;
  // {"10 НМИЦ им.академика Е.Н.Мешалкина"                                        ,10},;
  // {"11 НМИЦ эпидемиологии и микробиологии им.почетного академика Н.Ф.Гамалеи"  ,11},;
  // {"12 НМИЦ профилактической медицины"                                         ,12},;
  // {"13 НМИЦ эндокринологии"                                                    ,13},;
  // {"14 НМИЦ онкологии им.Н.Н.Петрова"                                          ,14},;
  // {"15 НМИЦ реабилитации и курортологии"                                       ,15},;
  // {"16 НМИЦ гематологии"                                                       ,16},;
  // {"17 НМИЦ психиатрии и неврологии им.В.М.Бехтерева"                          ,17},;
  // {"18 НМИЦ нейрохирургии им.академика Н.Н.Бурденко"                           ,18},;
  // {"19 НМИЦ травматологии и ортопедии им.Н.Н.Приорова"                         ,19},;
  // {"20 НМИЦ трансплантологии и искусственных органов им.академика В.И.Шумакова",20},;
  // {"21 НМИЦ хирургии им.А.В.Вишневского"                                       ,21},;
  // {'22 НМИЦ МНТК "Микрохирургия глаза" им.академика С.Н.Федорова'              ,22},;
  // {'23 НМИЦ фтизиопульмонологии и инфекционных заболеваний'                    ,23},;
  // {'24 НМИЦ глазных болезней имени Гельмгольца'                                ,24},;
  // {'25 ФГАОУ ВО "Сеченовский Университет"'                                     ,25},;
  // {'26 НМИЦ им Н.И. Пирогова'                                                  ,26},;
  // {'27 ФГБОУ Московский гос.медико-стоамтологический ун-т им.А.И.Евдокимова'   ,27},;
  // {'28 ФГБОУ Санкт-Петербургский гос.педиатрический медицинский университет'   ,28},;
  // {'29 НМИЦ травматологии и ортопедии имени Р.Р. Вредена'                      ,29},;
  // {'30 НМИЦ травматологии и ортопедии имени академика Г.А. Илизарова'          ,30},;
  // {'31 НМИЦ детской травматологии и ортопедии имени Г.И. Турнера'              ,31},;
  // {'32 НМИЦ онкологии'                                                         ,32},;
  // {'33 НМИЦ стоматологии и челюстно-лицевой хирургии'                          ,33},;
  // {'34 НМИЦ Лечебно-реабилитационный центр'                                    ,34},;
  // {'35 НМИЦ колопроктологии им. А.Н. Рыжих'                                    ,35},;
  // {'36 НМИЦ оториноларингологии ФМБА'                                          ,36};
  // }
  Public mm_komu := { {'СМО/ТФОМС (ОМС)', 0}, ;
                      {'Прочие компании', 1}, ;
                      {'Комитеты/МО    ', 3}, ;
                      {'Личный счёт    ', 5} ;
  }
  Public glob_arr_smo := { ;
    {'ООО "Капитал МС"',       34007, 1}, ;
    {'ОАО "СОГАЗ-Мед"',        34002, 1}, ;
    {'АО ВТБ Мед.страхование', 34003, 0}, ;  // не работает
    {'ООО "ВСК-Милосердие"',   34004, 0}, ;  // не работает
    {'КапиталЪ Медстрах',      34001, 0}, ;
    {'ООО "МСК-Максимус"',     34006, 0}, ;
    {'ТФОМС (иногородние)' ,   34   , 1} ;
  }
// 1-код,2-имя,3-ИНН,4-КПП,5-ОГРН,6-адрес,7-банк,8-р.счет,9-БИК
Public arr_rekv_smo := {;
  {"34001",;
   'ФИЛИАЛ ЗАКРЫТОГО АКЦИОНЕРНОГО ОБЩЕСТВА "КАПИТАЛ МЕДИЦИНСКОЕ СТРАХОВАНИЕ" В ГОРОДЕ ВОЛГОГРАДЕ',;
   "7709028619",;
   "344343001",;
   "1028601441274",;
   "400075 Волгоградская обл., г.Волгоград, ул.Историческая, д.122",;
   "",;
   "",;
   "";
  },;
  {"34002",;
   'ВОЛГОГРАДСКИЙ ФИЛИАЛ АКЦИОНЕРНОГО ОБЩЕСТВА "СТРАХОВАЯ КОМПАНИЯ "СОГАЗ - МЕД"',;
   "7728170427",;
   "344343001",;
   "1027739008440",;
   "400105 Волгоградская обл., г.Волгоград, ул.Штеменко, д.5",;
   "",;
   "",;
   "";
  },;
  {"34003",;
   'АКЦИОНЕРНОЕ ОБЩЕСТВО ВТБ МЕДИЦИНСКОЕ СТРАХОВАНИЕ',;
   "7704103750",;
   "774401001",;
   "1027739815245",;
   "400005 Волгоградская обл., г.Волгоград, ул.Мира, д.19",;
   "",;
   "",;
   "";
  },;
  {"34004",;
   'ВОЛГОГРАДСКИЙ ФИЛИАЛ ОБЩЕСТВА С ОГРАНИЧЕННОЙ ОТВЕТСТВЕННОСТЬЮ "СТРАХОВАЯ КОМПАНИЯ ВСК МИЛОСЕРДИЕ"',;
   "7730519137",;
   "775001001",;
   "1057746135325",;
   "400131 Волгоградская обл., г.Волгоград, ул.Коммунистическая, д.32",;
   "",;
   "",;
   "";
  },;
  {"34006",;
   'ФИЛИАЛ ОБЩЕСТВА С ОГРАНИЧЕННОЙ ОТВЕТСТВЕННОСТЬЮ "МЕДИЦИНСКАЯ СТРАХОВАЯ КОМПАНИЯ "МАКСИМУС" В Г.ВОЛГОГРАДЕ',;
   "6161056686",;
   "344445001",;
   "1106193000022",;
   "400074 Волгоградская обл., г.Волгоград, ул.Ковровская, д.24",;
   "",;
   "",;
   "";
  },;
  {"34007",;
   'ФИЛИАЛ ОБЩЕСТВА С ОГРАНИЧЕННОЙ ОТВЕТСТВЕННОСТЬЮ "КАПИТАЛ МЕДИЦИНСКОЕ СТРАХОВАНИЕ" В ВОЛГОГРАДСКОЙ ОБЛАСТИ',;
   "7813171100",;
   "344303001",;
   "1027806865481",;
   "400074 Волгоградская обл., г.Волгоград, ул.Рабоче-Крестьянская, д.30А",;
   "",;
   "",;
   "";
  },;
  {"34   ",;
   'ГОСУДАРСТВЕННОЕ УЧРЕЖДЕНИЕ "ТЕРРИТОРИАЛЬНЫЙ ФОНД ОБЯЗАТЕЛЬНОГО МЕДИЦИНСКОГО СТРАХОВАНИЯ ВОЛГОГРАДСКОЙ ОБЛАСТИ"',;
   "          ",;
   "         ",;
   "1023403856123",;
   "400005 г.Волгоград, проспект Ленина, 56а",;
   "",;
   "",;
   "";
  };
 }
//
  Public mm_month := {'январь', 'февраль', 'март', 'апрель', 'май', 'июнь', ;
                    'июль', 'август', 'сентябрь', 'октябрь', 'ноябрь', 'декабрь'}
  Public mm_monthR := {'январе', 'феврале', 'марте', 'апреле', 'мае', 'июне', ;
                     'июле', 'августе', 'сентябре', 'октябре', 'ноябре', 'декабре'}
  //
  Public tmp_ini := 'TMP' + sini
  Public tools_ini := dir_server + 'TOOLS' + sini
  Public local_tools_ini := 'LOCTOOLS' + sini
  Public f_stat_com := dir_exe + 'stat_com' + sfrm
  Public f_stat_lpu := dir_server + 'stat_lpu' + sini
  Public file_uchast := dir_server + 'prik_uch' + smem
  Public mm_danet := {{'нет', 0}, {'да ', 1}}
  Public mm_vid_polis := {{'старый', 1}, {'врем. ', 2}, {'новый ', 3}}
  Public mm_gorod_selo := {{'город', 1}, {'село', 2}, {'р/поселок', 3}}
  Public menu_vzros := {{'взрослый ', 0}, {'ребёнок  ', 1}, {'подросток', 2}}
  Public menupol := {'М', 'Ж'}
  Public menu_rab := {{"работающий  ",0},;
                    {"неработающий",1},;
                    {"обучающ.ОЧНО",2}}
  Public menu_predst := {{"родитель",1},;
                       {"опекун  ",2},;
                       {"прочий  ",0}}
  Public mm_ekst := {{"в плановом порядке",0},;
                   {"по экст.показаниям",1},;
                   {"неотложная помощь ",2}}
  Public mm_vskrytie := {{"не проводилось",0},;
                       {"паталого-анатомическое",1},;
                       {"судебно-медицинское",2}}
  Public mm_ekst_smp := {{"неотложная",0},;
                       {"экстренная",1}}
  Public mm_tip_school := {{"дошкольные учреждения",1},;
                         {"общие образовательные",0},;
                         {"професс., специальные",2}}
  Public mm_vid_reab := {{"- не вводился -",0},;
                       {"без наличия системы кохлеарной имплантации у пациента",1},;
                       {"после кохлеарной имплантации, за исключением замены речевого процессора",2},;
                       {"после замены речевого процессора",3}}
  // Public garr_par_org := {; // перечень парных органов
  // {"1 Правая нижняя конечность",1},;
  // {"2 Левая нижняя конечность",2},;
  // {"3 Правая верхняя конечность",3},;
  // {"4 Левая верхняя конечности",4},;
  // {"5 Правая молочная железа",5},;
  // {"6 Левая молочная железа",6},;
  // {"7 Правый глаз, придатки глаза",7},;
  // {"8 Левый глаз, придатки глаза",8},;
  // {"9 Правая сторона",9},;
  // {"10 Левая сторона",10},;
  // {"11 Таз (правая сторона)",11},;
  // {"12 Таз (левая сторона)",12},;
  // {"13 Грудная клетка (правая сторона)",13},;
  // {"14 Грудная клетка (левая сторона)",14},;
  // {"15 Верхняя челюсть",15},;
  // {"16 Нижняя челюсть",16},;
  // {"17 Позвоночник",17},;
  // {"18 Грудина",18}}

// Public mm_prich_inv := {; // Причина инвалидности
//   {"общее заболевание",1},;
//   {"трудовое увечье",2},;
//   {"профессиональное заболевание",3},;
//   {"инвалидность с детства",4},;
//   {"инвалидность с детства вследствие ранения (боевые действия в период ВОВ)",5},;
//   {"военная травма",6},;
//   {"заболевание получено в период военной службы",7},;
//   {"заболевание радиационное (при исполнении военной службы) на Чернобыльской АЭС",8},;
//   {"заболевание связано с катастрофой на Чернобыльской АЭС",9},;
//   {"заболевание (иные обязанности исполнения военной службы) на Чернобыльской АЭС",10},;
//   {'заболевание связано с аварией на ПО "Маяк"',11},;
//   {'заболевание (иные обязанности исполнения военной службы) на ПО "Маяк"',12},;
//   {"заболевание связано с последствиями радиационных воздействий",13},;
//   {"заболевание радиационное (при исполнении военной службы) подразд.особого риска",14},;
//   {"заболевание (ранение) при обслуживавании в/ч ВС СССР и РФ, воюющих за рубежом",15},;
//   {"иные причины, установленные законодательством РФ",16}}
// Public menu_vidud := {}
// aadd(menu_vidud, {"Паспорт гражд.СССР",1,1,"ПАСПОРТ"})
// aadd(menu_vidud, {"Загранпасп.гражд.СССР",2,0,"ЗГПАСПОРТ"})
// aadd(menu_vidud, {"Свид-во о рождении (РФ)",3,1,"св-во о рож.РФ"})
// aadd(menu_vidud, {"Уд-ние личности офицера",4,0,"УДОСТ ОФИЦЕРА"})
// aadd(menu_vidud, {"Справка об освобождении",5,1,"СПРАВКА ОБ ОСВ"})
// aadd(menu_vidud, {"Паспорт Минморфлота",6,0,"ПАСПОРТ МОРФЛТ"})
// aadd(menu_vidud, {"Военный билет",7,0,"ВОЕННЫЙ БИЛЕТ"})
// aadd(menu_vidud, {"Дипл.паспорт гражд.РФ",8,0,"ДИППАСПОРТ РФ"})
// aadd(menu_vidud, {"Иностранный паспорт",9,1,"ИНОСТР ПАСПОРТ"})
// aadd(menu_vidud, {"Свидетельство...беженца",10,0,"СВИД БЕЖЕНЦА"})
// aadd(menu_vidud, {"Вид на жительство",11,1,"ВИД НА ЖИТЕЛЬ"})
// aadd(menu_vidud, {"Удост-ие беженца в РФ",12,1,"УДОСТ БЕЖЕНЦА"})
// aadd(menu_vidud, {"Врем.уд.личн.гражд.РФ",13,1,"ВРЕМ УДОСТ"})
// aadd(menu_vidud, {"Паспорт гражд.России",14,1,"паспорт России"})
// aadd(menu_vidud, {"Загранпасп.гражд.РФ",15,1,"ЗПАСПОРТ РФ"})
// aadd(menu_vidud, {"Паспорт моряка",16,0,"ПАСПОРТ МОРЯКА"})
// aadd(menu_vidud, {"Военный билет оф.запаса",17,0,"ВОЕН БИЛЕТ ОЗ"})
// aadd(menu_vidud, {"Иные документы",18,1,"ПРОЧЕЕ"})
// aadd(menu_vidud, {"Док-т инос.гражданина",21,0,"ИНОСТР ГРАЖДАН"})
// aadd(menu_vidud, {"Док-т лица без гражданства",22,0,"ЛИЦО БЕЗ ГРАЖД"})
// aadd(menu_vidud, {"Разр-ие на врем.проживание",23,0,"РАЗР НА ВР.ПР."})
// aadd(menu_vidud, {"Свид-во о рожд.(не в РФ)",24,0,"св.о рож.не РФ"})
//
// Public menu_osn_preb_RF := {; // Основания пребывания в РФ
//   {"ВЖ (вид на жительство)",1},;
//   {"РВП (разрешение на временнное пребывание)",0},;
//   {"Миграционная карта",2},;
//   {"Туристическая виза",3},;
//   {"Медицинская виза",4},;
//   {"Гостевая виза",5},;
//   {"Деловая виза",6},;
//   {"Транзитная виза",7},;
//   {"Студенческая виза",8},;
//   {"Рабочая виза",9},;
//   {"Другая виза",10};
// }
//
// Public mm_bukva := {;
//   {"A-амбулаторно-поликлиническая помощь (A)"    ,"A"},;
//   {"B-СМП с тромболитической терапией"           ,"B"},;
//   {"D-диспансеризация детей-сирот (стационарных)","D"},;
//   {"E-скорая медицинская помощь"                 ,"E"},;
//   {"F-профилактический осмотр несовершеннолетних","F"},;
//   {"G-дерматовенерологическая помощь"            ,"G"},;
//   {"H-высокотехнологичная медицинская помощь"    ,"H"},;
//   {"I-периодический осмотр несовершеннолетних"   ,"I"},;
//   {"J-амбулаторно-поликлиническая помощь (J)"    ,"J"},;
//   {"K-отдельные медицинские услуги"              ,"K"},;
//   {"M-законченный случай в стационаре (1.7.*)"   ,"M"},;
//   {"N-стационарная помощь/дополнительные объёмы" ,"N"},;
//   {"O-диспансеризация взрослого населения"       ,"O"},;
//   {"R-профилактика взрослого населения"          ,"R"},;
//   {"S-стационарная помощь"                       ,"S"},;
//   {"T-стоматологическая помощь"                  ,"T"},;
//   {"U-диспансеризация детей-сирот (под опекой)"  ,"U"},;
//   {"V-предварительный осмотр несовершеннолетних" ,"V"},;
//   {"W-углубленная диспансеризация первый этап"   ,"W"},;
//   {"Y-углубленная диспансеризация второй этап"   ,"Y"},;
//   {"Z-дневной стационар"                         ,"Z"};
//  }
Public stm_kategor := {;  // код категории льготы
  {"инвалиды войны",1,1},;
  {"участники Великой Отечественной войны",2,2},;
  {'ветераны боевых действий (закон №5-ФЗ от 12.01.95г. "О ветеранах")',8,3},;
  {"военнослужащие не из действующей армии (период 22.06.41-03.09.45)",5,4},;
  {'лица, награждённые знаком "Жителю блокадного Ленинграда"',4,5},;
  {"лица, работавшие в период ВОВ на объектах ПВО и т.п.",14,6},;
  {"члены семей погибших (умерших) инвалидов войны, УВОВ, ветеранов...",3,7},;
  {"инвалиды",6,8},;
  {"дети-инвалиды",7,9},;
  {"Подв.рад.облуч.",9,0},;
  {"Подв.рад.облуч.(ЧАЭС)",91,0},;
  {"Подв.рад.обл.(Сем.п.)",92,0},;
  {"Подв.рад.облуч.(др.)",93,0},;
  {"Реабилитированный",10,0},;
  {"Подросток",11,0},;
  {"Ребенок до года",12,0},;
  {"прочие",13,13}}
Public stm_povod := {;
  {"Лечебно-диагностический",1},;
  {"Консультативный",2},;
  {"Диспансерное наблюдение",3},;
  {"Профилактический",4},;
  {"Профессиональный осмотр",5},;
  {"Реабилитационный",6},;
  {"Зубопротезный",7},;
  {"Протезно-ортопедический",8},;
  {"Прочий",9}}
Public stm_travma := {;
  {"__ нет __",0},;
  {"Промышленная",1},;
  {"Сельскохозяйственная",2},;
  {"Строительная",3},;
  {"Дорожно-транспортная пр-венная",4},;
  {"Прочая производственная",5},;
  {"Бытовая",6},;
  {"Уличная",7},;
  {"Дор.трансп., не связанная с пр-вом",8},;
  {"Школьная",9},;
  {"Спортивная",10},;
  {"Прочая, не связанная с пр-вом",11}}
Public rule_section := ;
  {"СПИСОК ОСТРЫХ ЗАБОЛЕВАНИЙ - ВСЕГДА ПЕРВИЧНЫЕ",;
   "СПИСОК ЗАБОЛЕВАНИЙ, ПО КОТОРЫМ ДОЛЖНА БЫТЬ ДИСПАНСЕНРИЗАЦИЯ",;
   "СПИСОК ОГРАНИЧЕНИЙ ДИАГНОЗОВ ПО ПОЛОВОМУ ПРИЗНАКУ",;
   "СПИСОК ДИАГНОЗОВ, КОТОРЫЕ ВООБЩЕ НЕ ДОЛЖНЫ ВВОДИТЬСЯ",;
   "ДАННЫЕ БУКВЫ У ОДНОГО БОЛЬНОГО ВСТРЕЧАЮТСЯ ТОЛЬКО РАЗ В ГОДУ",;
   "ТОЛЬКО ОДНА ИЗ ДАННЫХ БУКВ У БОЛЬНОГО ВСТРЕЧАЕТСЯ РАЗ В ГОД"}
Public mm1ist_fin :=  {{"бюджет",      I_FIN_BUD},;   // 1
                       {"расчеты с МО",I_FIN_LPU},;   // 2
                       {"платные",     I_FIN_PLAT},;  // 0
                       {"ДМС",         I_FIN_DMS},;   // 5
                       {"не оплачен",  I_FIN_NEOPL},; // 3
                       {"за свой счёт",I_FIN_OWN}}    // 4
Public mm_ist_fin := aclone(mm1ist_fin)
Ins_Array(mm_ist_fin,1,{"ОМС",         I_FIN_OMS})
// прочие компании
Public gmenu_strah := {}
aadd(gmenu_strah, {"name","C",30,0,NIL,NIL,;
                   space(30),NIL,"Название"})
aadd(gmenu_strah, {"fname","C",70,0,NIL,NIL,;
                   space(70),NIL,"Полное наименование"})
aadd(gmenu_strah, {"inn","C",20,0,NIL,NIL,;
                   space(20),NIL,"ИНН/КПП"})
aadd(gmenu_strah, {"adres","C",50,0,NIL,NIL,;
                   space(50),NIL,"Адрес"})
aadd(gmenu_strah, {"telefon","C",8,0,NIL,NIL,;
                   "  -  -  ",NIL,"Телефон"})
aadd(gmenu_strah, {"bank","C",70,0,NIL,NIL,;
                   space(70),NIL,"Банк"})
aadd(gmenu_strah, {"smfo","C",10,0,NIL,NIL,space(10),NIL,;
                   "БИК"})
aadd(gmenu_strah, {"r_schet","C",45,0,NIL,NIL,space(45),NIL,;
                   "Расчетный счет"})
aadd(gmenu_strah, {"k_schet","C",20,0,NIL,NIL,space(20),NIL,;
                   "Корр.счет"})
aadd(gmenu_strah, {"okonh","C",15,0,NIL,NIL,space(15),NIL,;
                   "Код по ОКОНХ"})
aadd(gmenu_strah, {"okpo","C",15,0,NIL,NIL,space(15),NIL,;
                   "Код по ОКПО"})
aadd(gmenu_strah, {"tfoms","N",2,0,NIL,NIL,0,NIL,;
                   "Код ТФОМС",,{||.f.}})
aadd(gmenu_strah, {"parakl","N",1,0,NIL,;
                   {|x|menu_reader(x,mm_danet,A__MENUVERT)},;
                   0,{|x|inieditspr(A__MENUVERT,mm_danet,x)},;
                   'Включать ПАРАКЛИНИКУ в сумму счета по данной компании:'})
aadd(gmenu_strah, {"ist_fin","N",1,0,NIL,;
                   {|x|menu_reader(x,mm1ist_fin,A__MENUVERT)},;
                   0,{|x|inieditspr(A__MENUVERT,mm1ist_fin,x)},;
                  'Источник финансирования:'})
// комитеты/МО
Public gmenu_komit := {}
aadd(gmenu_komit, {"name","C",30,0,NIL,NIL,;
                   space(30),NIL,"Название"})
aadd(gmenu_komit, {"fname","C",70,0,NIL,NIL,;
                   space(70),NIL,"Полное наименование"})
aadd(gmenu_komit, {"inn","C",20,0,NIL,NIL,;
                   space(20),NIL,"ИНН/КПП"})
aadd(gmenu_komit, {"adres","C",50,0,NIL,NIL,;
                   space(50),NIL,"Адрес"})
aadd(gmenu_komit, {"telefon","C",8,0,NIL,NIL,;
                   "  -  -  ",NIL,"Телефон"})
aadd(gmenu_komit, {"bank","C",70,0,NIL,NIL,;
                   space(70),NIL,"Банк"})
aadd(gmenu_komit, {"smfo","C",10,0,NIL,NIL,space(10),NIL,;
                   "БИК"})
aadd(gmenu_komit, {"r_schet","C",45,0,NIL,NIL,space(45),NIL,;
                   "Расчетный счет"})
aadd(gmenu_komit, {"k_schet","C",20,0,NIL,NIL,space(20),NIL,;
                   "Корр.счет"})
aadd(gmenu_komit, {"okonh","C",15,0,NIL,NIL,space(15),NIL,;
                   "Код по ОКОНХ"})
aadd(gmenu_komit, {"okpo","C",15,0,NIL,NIL,space(15),NIL,;
                   "Код по ОКПО"})
aadd(gmenu_komit, {"parakl","N",1,0,NIL,;
                   {|x|menu_reader(x,mm_danet,A__MENUVERT)},;
                   0,{|x|inieditspr(A__MENUVERT,mm_danet,x)},;
                   'Включать ПАРАКЛИНИКУ в сумму счета по данному комитету (МО):'})
aadd(gmenu_komit, {"ist_fin","N",1,0,NIL,;
                   {|x|menu_reader(x,mm1ist_fin,A__MENUVERT)},;
                   0,{|x|inieditspr(A__MENUVERT,mm1ist_fin,x)},;
                   'Источник финансирования:'})
// ДСМО и предприятия по взаимозачёту для платных услуг
Public gmenu_pl_d_smo := {}
aadd(gmenu_pl_d_smo, {"name","C",30,0,NIL,NIL,;
                      space(30),NIL,"Название"})
aadd(gmenu_pl_d_smo, {"fname","C",70,0,NIL,NIL,;
                      space(70),NIL,"Полное наименование"})
aadd(gmenu_pl_d_smo, {"inn","C",20,0,NIL,NIL,;
                      space(20),NIL,"ИНН/КПП"})
aadd(gmenu_pl_d_smo, {"adres","C",100,0,NIL,NIL,;
                      space(100),NIL,"Адрес"})
aadd(gmenu_pl_d_smo, {"telefon","C",8,0,NIL,NIL,;
                      "  -  -  ",NIL,"Телефон"})
aadd(gmenu_pl_d_smo, {"bank","C",100,0,NIL,NIL,;
                      space(100),NIL,"Банк"})
aadd(gmenu_pl_d_smo, {"smfo","C",10,0,NIL,NIL,space(10),NIL,;
                      "БИК"})
aadd(gmenu_pl_d_smo, {"r_schet","C",45,0,NIL,NIL,space(45),NIL,;
                      "Расчетный счет"})
aadd(gmenu_pl_d_smo, {"k_schet","C",20,0,NIL,NIL,space(20),NIL,;
                      "Корр.счет"})
aadd(gmenu_pl_d_smo, {"n_dog","C",30,0,NIL,NIL,space(30),NIL,;
                      "Номер договора"})
aadd(gmenu_pl_d_smo, {"d_dog","D",8,0,NIL,NIL,ctod(""),NIL,;
                      "Дата договора"})
// Ваша организация
Public gmenu_organ := {},;
       mm_filial_tf := {{"Волгоградский",1},;
                        {"Заволжский",2},;
                        {"Северный",3},;
                        {"Медведицкий",4},;
                        {"Хопёрский",5},;
                        {"Южный",6}}
aadd(gmenu_organ, {"kod_tfoms","C",8,0,NIL,NIL,;
                   space(8),NIL,;
                   'Регистрационный код МО в ТФОМС',;
                   {|g| valid_kod_tfoms(g) },;
                   {|| hb_user_curUser:IsAdmin()}})
aadd(gmenu_organ, {"name_tfoms","C",60,0,NIL,,'',,'Наименование (в ТФОМС)',,{||.f.}})
aadd(gmenu_organ, {"uroven","N",1,0,NIL,,0,,'Уровень цен Вашей МО',,{||.f.}})
aadd(gmenu_organ, {"name","C",130,0,NIL,NIL,;
                   space(130),NIL,"Название"})
aadd(gmenu_organ, {"name_schet","C",130,0,NIL,NIL,;
                   space(130),NIL,"Название для счёта"})
aadd(gmenu_organ, {"name_xml","C",255,0,NIL,NIL,;
                   space(255),NIL,"Название для портала МЗ РФ"})
aadd(gmenu_organ, {"inn","C",20,0,NIL,NIL,;
                   space(20),NIL,"ИНН/КПП"})
aadd(gmenu_organ, {"adres","C",70,0,NIL,NIL,;
                   space(70),NIL,"Адрес"})
aadd(gmenu_organ, {"telefon","C",20,0,NIL,NIL,;
                   space(20),NIL,"Телефон"})
aadd(gmenu_organ, {"bank","C",130,0,NIL,NIL,;
                   space(130),NIL,"Банк"})
aadd(gmenu_organ, {"smfo","C",10,0,NIL,NIL,space(10),NIL,;
                   "БИК"})
aadd(gmenu_organ, {"r_schet","C",45,0,NIL,NIL,space(45),NIL,;
                   "Расчетный счет"})
aadd(gmenu_organ, {"k_schet","C",20,0,NIL,NIL,space(20),NIL,;
                   "Корр.счет"})
aadd(gmenu_organ, {"okonh","C",15,0,NIL,NIL,space(15),NIL,;
                   "Код по ОКОНХ"})
aadd(gmenu_organ, {"okpo","C",15,0,NIL,NIL,space(15),NIL,;
                   "Код по ОКПО"})
aadd(gmenu_organ, {"e_1","C",1,0,NIL,NIL,;
                   space(1),NIL,"Банковские реквизиты для перечисления доплат из средств субсидий ФФОМС:",,;
                   {||.f.}})
aadd(gmenu_organ, {"name2","C",130,0,NIL,NIL,;
                   space(130),NIL,space(5)+"- название"})
aadd(gmenu_organ, {"bank2","C",130,0,NIL,NIL,;
                   space(130),NIL,space(5)+"- банк"})
aadd(gmenu_organ, {"smfo2","C",10,0,NIL,NIL,space(10),NIL,;
                   space(5)+"- БИК"})
aadd(gmenu_organ, {"r_schet2","C",45,0,NIL,NIL,space(45),NIL,;
                   space(5)+"- расчетный счет"})
aadd(gmenu_organ, {"k_schet2","C",20,0,NIL,NIL,space(20),NIL,;
                   space(5)+"- корр.счет"})
aadd(gmenu_organ, {"ogrn","C",15,0,,,space(15),,;
                   "ОГРН ЛПУ"})
aadd(gmenu_organ, {"ruk_fio","C",60,0,,,space(60),,;
                   "Ф.И.О. главного врача"})
aadd(gmenu_organ, {"ruk","C",20,0,,,space(20),,;
                   "Фамилия и инициалы главного врача (им.падеж)"})
aadd(gmenu_organ, {"ruk_r","C",20,0,,,space(20),,;
                   "Фамилия и инициалы главного врача (род.падеж)"})
aadd(gmenu_organ, {"bux","C",20,0,,,space(20),,;
                   "Фамилия и инициалы главного бухгалтера"})
aadd(gmenu_organ, {"ispolnit","C",20,0,,,space(20),,;
                   "Ф.И.О. исполнителя для счетов ОМС"})
aadd(gmenu_organ, {"name_d","C",32,0,,,space(32),,;
                   "Наименование орг-ии (для договора)"})
aadd(gmenu_organ, {"filial_h","N",1,0,NIL,;
                   {|x|menu_reader(x,mm_filial_tf,A__MENUVERT)},;
                   0,{|x|inieditspr(A__MENUVERT,mm_filial_tf,x)},;
                   "Филиал ТФОМС, в который отправляется файл с ходатайствами"})
R_Use(dir_server+"organiz",,"ORG")
fl := (fieldnum("name_xml") == 0)
use
if fl
  init_base(dir_server+"organiz",,gmenu_organ,0,,.t.)
endif
//
Public mm_ortispol := {{"Техник",0},;
                       {"Врач",1}}
Public gmenutorto := {}
aadd(gmenutorto, {"name","C",65,0,NIL,NIL,;
                  space(65),NIL,"Наименование материала"})
aadd(gmenutorto, {"tip","N",1,0,NIL,;
                  {|x|menu_reader(x,mm_ortispol,A__MENUVERT)},;
                  0,{|x|inieditspr(A__MENUVERT,mm_ortispol,x)},;
                  'Исполнитель услуги'})
// приёмный покой
Public glob_perso_pp := 0 // код по БД mo_pp
Public pict_time := "99:99"
Public mmpp_regim := {; // ИСПРАВЛЕННОЕ меню режима лечения
  {"стационар круглосуточного пребывания",1},;   // 1
  {"дневной стационар при больнице",2},;   // 3
  {"дневной стационар при поликлинике",3},;   // 3
  {"дневной стационар на дому",4}}    // 3
Public mmpp_rab := {; // ИСПРАВЛЕННОЕ меню социального статуса (битовое)
  {"Дошкольник",1},;  //
  {"Организован",2},;  //
  {"Неорганизован",3},;  //
  {"Учащийся",4},;  //
  {"Призывник",11},;  //
  {"Работает",5},;     // 0
  {"Не работает",6},;  // 1
  {"БОМЖ",7},;  //
  {"Пенсионер",8},;  //
  {"Военнослужащий",9},;  // еще ?? какой-то код
  {"Член семьи воен-го",10}}
Public mmpp_kategor := {;  // ИСПРАВЛЕННОЕ меню категорий
  {"Инвалид ВОВ",1,1},;
  {"Участник ВОВ",2,2},;
  {"Воин-интернационалист",3,8},;
  {"Участник боевых действий",12,8},;
  {"Лицо, подвергшееся рад.облуч",4,9},;
  {"в т.ч. подв.рад.облуч.(ЧАЭС)",5,91},;
  {"Инвалид I группы",6,6},;
  {"Инвалид II группы",7,6},;
  {"Инвалид III группы",8,6},;
  {"Ребенок-инвалид",9,7},;
  {"Инвалид с детства",10,6},;
  {"Прочие",11,13}}
Public mmpp_travma := {;   // ИСПРАВЛЕННОЕ меню видов травм
  {"--",0},;
  {"Промышленная",1},;
  {"Транспортная производственная",2},;
  {"  в т.ч. ДТП производственная",3},;
  {"Сельскохозяйственная",4},;
  {"Прочая производственная",5},;
  {"Бытовая",6},;
  {"Уличная",7},;
  {"Трансп., не связанная с пр-ством",8},;
  {"  в т.ч. ДТП непроизводственная",9},;
  {"Школьная",10},;
  {"Спортивная",11},;
  {"Противоправная травма",12},;
  {"Прочая, не связанная с пр-ством",13}}
Public menu_stdnst:= {{"стационар ",0},;
                      {"днев.стац.",1}}
Public menu_sost_op:= {{"--            ",0},;
                       {"алкогольного  ",1},;
                       {"наркотического",2}}
Public menu0gospit := {{"первично",0},;
                       {"повторно",1}}
Public menu2gospit := {{"в первые 6 часов",1},;
                       {"в теч.7-24 часов",2},;
                       {"позднее 24 часов",0}}
Public menu_vid_opl := {{"ОМС",1},;  //  (битовое)
                        {"Бюджет",2},;
                        {"Пл.услуги",3},;
                        {"ДМС",4},;
                        {"Другое",5}}
Public mmpp_kem_dost := {{"самостоятельно",0},;
                         {"скорой помощью",1},;
                         {"скорой помощью (транспорт)",2},;
                         {"прочее",99}}
Public mmpp_pr_gospit := {{"отказался от госпитализации",1},;
                          {"карантин в отделении       ",2},;
                          {"отказ по сопутс.заболеванию",3},;
                          {"нет показаний для госпит-ии",4},;
                          {"направлен в другое МО      ",5},;
                          {"оказана амб.пом. в пр.покое",99}}
Public mmpp1ishod := {{"выписан",1},;
                      {"в т.ч. в дневной стационар",2},;
                      {"в круглосуточный стационар",3},;
                      {"переведен в другой стационар",4}}
Public mmpp2ishod := {{"выздоровление",1},;
                      {"улучшение",2},;
                      {"без перемен",3},;
                      {"ухудшение",4},;
                      {"здоров",5},;
                      {"умер",6}}
// Public mm_err_csv_prik := {;
//   {"Неверная команда",1},;
//   {"Отсутствует единый номер полиса для полиса ОМС единого образца",2},;
//   {'Длина временного номера полиса не равна 9',3},;
//   {'Длина нового номера полиса не равна 16 (неверная контрольная сумма)',4},;
//   {"Недопустимые знаки или сочетания знаков в фамилии",5},;
//   {"Недопустимые знаки или сочетания знаков в имени",6},;
//   {"Недопустимые знаки или сочетания знаков в отчестве",7},;
//   {"Не указана дата рождения",10},;
//   {"Ошибка в дате рождения (указана нереальная дата)",11},;
//   {"Указан некорректный СНИЛС",12},;
//   {"В строке имеются недопустимые символы",13},;
//   {"Неверный порядковый номер файла",19},;
//   {"Дата актуализации больше текущей даты",20},;
//   {"Ошибка в значении СНИЛС",21},;
//   {"Ошибка в контрольном числе СНИЛС",22},;
//   {"Неверный код территории",24},;
//   {"Отсутствует серия и номер для полиса ОМС старого образца или номер для временного свидетельства",25},;
//   {"Ошибка в заголовке метаданных файла",38},;
//   {"Ошибка в формате даты прикрепления",46},;
//   {"Не указана дата актуализации",86},;
//   {"Дата прикрепления больше даты актуализации",87},;
//   {"Формат единого номера полиса неверен",102},;
//   {"Неверная версия формата",183},;
//   {"Не указан СНИЛС медицинского работника",239},;
//   {"Не указан код способа прикрепления к МО",242},;
//   {"Недопустимый код способа прикрепления к МО",243},;
//   {"Дата прикрепления не заполнена",245},;
//   {"Ошибка в дате прикрепления",246},;
//   {"Реестровый номер МО не указан",264},;
//   {"Реестровый номер МО не найден",265},;
//   {"Неверный формат реестрового номера МО",300},;
//   {"По предоставленным данным застрахованное лицо не найдено в регистре застрахованных лиц",404},;
//   {"Единый номер полиса не найден в регистре застрахованных лиц",500},;
//   {"Невозможно идентифицировать застрахованное лицо в едином регистре застрахованных лиц",522},;
//   {"Единый номер полиса не соответствует указанному документу, подтверждающему факт страхования",525},;
//   {"МО не работает на территории",541},;
//   {'Застрахованное лицо не прикреплено к МО (для операции "И" не найдена действующая запись о прикреплении)',542},;
//   {"Медработник не найден в Федеральном реестре медработников",543},;
//   {"Медработник не работает в указанной МО",544},;
//   {"Указан второй медработник с той же должностью",545},;
//   {"Указан третий медработник (более двух прикреплений)",546},;
//   {"Дата прикрепления к медработнику меньше даты прикрепления к МО или предыдущему медработнику",547},;
//   {"В реестре отсутствуют сведения по прикреплению указанного лица к МО",548},;
//   {"Для лица, не идентифицированного в реестре застрахованных, не указан ЕНП",555},;
//   {"Дата заявления, указанная в файле, меньше имеющейся в СРЗ даты прикрепления",600},;
//   {"Прикрепление в течение одного года к этой же МО (некорректное прикрепление)",701},;
//   {"Прикрепление в течение одного года к другой МО (некорректное прикрепление)",702},;
//   {"На указанную дату прикрепления ЗЛ не имеет действующего страхования в Волгоградской области",703},;
//   {"Дата прикрепления больше даты смерти",704},;
//   {"Неверный способ прикрепления",705},;
//   {"Застрахованный умер",706},;
//   {"Неверный код способа прикрепления или прикрепление без изменения места жительства в одном году",707},;
//   {'Неверная дата прикрепления или неверно указана категория врача',708},;
//   {"ЗЛ уже прикреплено к Вашей организации по данным РС СРЗ",709},;
//   {"Ошибка в дате открепления",746},;
//   {"Обработка данных ЗЛ не выполнялась (направить повторно)",801},;
//   {"ЗЛ не найдено в РС СРЗ (проверить данные и направить повторно)",802},;
//   {"Наличие ошибок ФЛК, прикладной обработки (проверить данные и направить повторно)",803},;
//   {"В программе обработки возникла исключительная ситуация",99};
//  }
// Public mm_reason_annul := {; // список причин не госпитализации пациента
//   {"1-отсутствие показаний для госпитализации",1},;
//   {"2-непредставление необходимого пакета документов (отказ стационара)",2},;
//   {"3-инициативный отказ от госпитализации пациентом",3},;
//   {"4-отказ от госпитализации по эпидемиологическим показаниям",4},;
//   {"5-карантин в стационарном отделении",5},;
//   {"6-направление застрахованного лица не по профилю заболевания",6},;
//   {"7-неявка пациента на госпитализацию",7},;
//   {"8-смерть до госпитализации",8},;
//   {"9-прочие причины",9};
//  }
rest_box(buf)
return NIL

** 05.05.19 инициализация программы
Function Init_Program()
Public mm_kdp2 := {{"в МО",0},{"КДП2",1},{"РДЛ ",2}}
Public mm_vokod := {{"в МО ",0},{"ВОКОД",3}}
Public glob_arr_usl_LIS := {;
  "4.11.136",;//   "Клинический анализ крови (развёрнутый)"
  "4.11.137",;//   "Клинический анализ крови (3 показателя)"
  "4.12.169",;//   "Исследование уровня глюкозы в крови"
  "4.12.170",;//   "Определение гликированного гемоглобина крови"
  "4.12.171",;//   "Тест на толерантность к глюкозе"
  "4.12.172",;//   "Биохимический общетерапевтическ.анализ крови"
  "4.12.173",;//   "Исследование липидного спектра крови"
  "4.12.174",;//   "Исследование крови на общий холестерин"
  "4.14.66",;//    "Кровь на простат-специфический антиген"
  "4.14.67" ,;//   "пролактин (гормон)"
  "4.14.68" ,;//   "фолликулостимулирующий гормон"
  "4.14.69" ,;//   "лютеинизирующий гормон"
  "4.14.70" ,;//   "эстрадиол (гормон)"
  "4.14.71" ,;//   "прогестерон (гормон)"
  "4.14.72" ,;//   "тиреотропный гормон"
  "4.14.73" ,;//   "трийодтиронин (гормон)"
  "4.14.74" ,;//   "тироксин (гормон)"
  "4.14.75" ,;//   "соматотропный гормон"
  "4.14.76" ,;//   "кортизол (гормон)"
  "4.14.77" ; //   "тестостерон (гормон)"
} 
InitSpravFFOMS()
// инициализация справочника специальностей в виде DBF-файла
init_tmp_prvs(,.t.)
// InitSpravOthers()
// диспансеризация детей-сирот
Public dds_arr_osmotr_KDP2 := {;  // замена на врачебные приёмы без гематологии
  {"2.83.1" ,"2.83.25"},; // пульмонолог
  {"2.83.2" ,"2.83.26"},; // дерматовенеролог
  {"2.83.3" ,"2.83.27"},; // ревматолог
  {"2.83.4" ,"2.83.28"},; // аллерголог-иммунолог
  {"2.83.5" ,"2.83.29"},; // детский кардиолог
  {"2.83.6" ,"2.83.30"},; // гастроэнтеролог
  {"2.83.7" ,"2.83.31"},; // нефролог
  {"2.83.8" ,"2.83.32"},; // гематолог
  {"2.83.9" ,"2.83.33"},; // инфекционист
  {"2.83.10","2.83.34"},; // детский онколог
  {"2.83.11","2.83.35"},; // нейрохирург
  {"2.83.12","2.83.36"},; // колопроктолог
  {"2.83.13","2.83.37"},; // сердечно-сосудистый хирург
  {"2.83.14","2.83.38"},; // педиатр
  {"2.83.15","2.83.39"},; // врач общей практики
  {"2.83.16","2.83.40"},; // акушер-гинеколог (девочки)
  {"2.83.17","2.83.41"},; // детский уролог-андролог (мальчики)
  {"2.83.18","2.83.42"},; // детский хирург
  {"2.83.19","2.83.43"},; // травматолог-ортопед
  {"2.83.20","2.83.44"},; // невролог
  {"2.83.21","2.83.45"},; // офтальмолог
  {"2.83.22","2.83.46"},; // оториноларинголог
  {"2.83.23","2.83.47"},; // детский стоматолог
  {"2.83.24","2.83.48"};  // детский эндокринолог
}
Public dds_arr_osm1 := {;
  {"офтальмолог","",0,17,{65},{1112},{"2.83.21"}},;
  {"оториноларинголог","",0,17,{162,64},{1111,111101},{"2.83.22"}},;
  {"детский хирург","",0,17,{20},{1135},{"2.83.18"}},;
  {"травматолог-ортопед","",0,17,{100},{1123},{"2.83.19"}},;
  {"акушер-гинеколог (девочки)","Ж",0,17,{136,2},{1101},{"2.83.16"}},;
  {"детский уролог-андролог (мальчики)","М",0,17,{19},{112603,113502},{"2.83.17"}},;
  {"детский стоматолог","",3,17,{86},{1401,140102},{"2.83.23"}},;
  {"детский эндокринолог","",5,17,{21},{1127,112702,113402},{"2.83.24"}},;
  {"невролог","",0,17,{53},{1109},{"2.83.20"}},;
  {"психиатр","",0,17,{72},{1115},{"2.4.1"}},;
  {"педиатр","",0,17,{68,57},{1134,1110},{"2.83.14","2.83.15"}};
 }
Public count_dds_arr_osm1 := len(dds_arr_osm1)
//
Public dds_arr_osm2 := {;
  {"пульмонолог","",0,17,{75},{113413,112208,112501},{"2.83.1"}},;
  {"дерматовенеролог","",0,17,{16},{1104},{"2.83.2"}},;
  {"ревматолог","",0,17,{77},{113414,112209},{"2.83.3"}},;
  {"аллерголог-иммунолог","",0,17,{4},{113405,112214},{"2.83.4"}},;
  {"детский кардиолог","",0,17,{17},{113403},{"2.83.5"}},;
  {"гастроэнтеролог","",0,17,{11},{113407,112201},{"2.83.6"}},;
  {"нефролог","",0,17,{56},{113412,112207},{"2.83.7"}},;
  {"гематолог","",0,17,{12},{113408,112202},{"2.83.8","2.3.1"}},;
  {"инфекционист","",0,17,{28},{1106},{"2.83.9"}},;
  {"детский онколог","",0,17,{18},{113401,112801,113501},{"2.83.10","2.3.1"}},;
  {"нейрохирург","",0,17,{54},{112602,113504},{"2.83.11"}},;
  {"колопроктолог","",0,17,{30},{112601,113503},{"2.83.12"}},;
  {"сердечно-сосудистый хирург","",0,17,{81},{112604,113505},{"2.83.13"}},;
  {"педиатр","",0,17,{68,57},{1134,1110},{"2.83.14","2.83.15"}};
 }
Public count_dds_arr_osm2 := len(dds_arr_osm2)
//
Public dds_arr_iss := {;
  {"Клинический анализ мочи","",0,17,{34},{1107,1301,1402,1702,1801,2011,2013},{"4.2.153"}},;
  {"Клинический анализ крови","",0,17,{34},{1107,1301,1402,1702,1801,2011,2013},{"4.11.136"}},;
  {"Исследование уровня глюкозы в крови","",0,17,{34},{1107,1301,1402,1702,1801,2011,2013},{"4.12.169"}},;
  {"Электрокардиография","",0,17,{111},{110103,110303,110906,111006,111905,112212,112611,113418,113509,180202,2021},{"13.1.1"}},;
  {"Флюорография легких (с 15 лет)","",15,17,{78},{1118,1802,2020},{"7.61.3"}},;
  {"УЗИ головного мозга (нейросонография) (до 1 года)","",0,0,{106},{110101,111004,111802,111903,112211,112610,113416,113508,180203},{"8.1.1"}},;
  {"УЗИ щитовидной железы (с 7 лет)","",7,17,{106},{110101,111004,111802,111903,112211,112610,113416,113508,180203},{"8.1.2"}},;
  {"УЗИ сердца","",0,17,{106},{110101,111004,111802,111903,112211,112610,113416,113508,180203},{"8.1.3"}},;
  {"УЗИ тазобедренных суставов (до 1 года)","",0,0,{106},{110101,111004,111802,111903,112211,112610,113416,113508,180203},{"8.1.4"}},;
  {"УЗИ органов брюшной полости комплексное профилактическое","",0,17,{106},{110101,111004,111802,111903,112211,112610,113416,113508,180203},{"8.2.1"}},;
  {"УЗИ органов репродуктивной системы","",7,17,{106},{110101,111004,111802,111903,112211,112610,113416,113508,180203},{"8.2.2","8.2.3"}};
 }
Public count_dds_arr_iss := len(dds_arr_iss)
// диспансеризация взрослого населения
Public arr_vozrast_DVN := {21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99}
Public arr2m_vozrast_DVN := {49,53,55,59,61,65,67,71,73} // 1 раз в 2 года все
Public arr2g_vozrast_DVN := {50,52,56,58,62,64,68,70}    // 1 раз в 2 года женщины
Public dvn_arr_usl18 := {; // Услуги на экран для ввода
  {"Измерение внутриглазного давления","3.4.9",1,0,1,;
    {60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    {60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    1,1,65,{1112};
   },;
  {"Исследование крови на общий холестерин","4.12.174",{1,3},0,1,;
    {21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84},;
    {21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84},;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Исследование уровня глюкозы в крови","4.12.169",{1,3},0,1,;
    1,1,1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Клинический анализ крови (3 показателя)","4.11.137",3,0,1,0,0,;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Исследование кала на скрытую кровь","4.8.4",{1,3,4},0,1,;
    {51,57,63,69},;
    {51,57,63,69},;
    {46,98},{46,98},34,{1107,1301,1402,1702,1801,2011,2013},,arr2m_vozrast_DVN,arr2m_vozrast_DVN;
   },;
  {"Кровь на простат-специфический антиген","4.14.66",1,0,1,;
    {45,51},;
    0,;
    1,0,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Осмотр акушеркой, взятие мазка (соскоба)","4.1.12",1,0,1,; // женщины
    0,;
    {30,33,36,39,42,45,48,51,54,57,60},;
    1,1,{3,42,136},{2003,2002,1101};
   },;
  {"Иссл-е взятого цитологического материала","4.20.1",1,0,1,; // если невозможна
    0,;                                                        // 4.1.12,
    {30,33,36,39,42,45,48,51,54,57,60},;     // то очистить
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};               // эту услугу
   },;
  {"Маммография обеих молочных желез","7.57.3",{1,3,4},0,1,; // женщины
    0,;
    {39,42,45,48,54,60,66},;
    0,{40,74},78,{1118,1802,2020},,0,arr2g_vozrast_DVN;
   },;
  {"Флюорография лёгких","7.61.3",{1,3},0,1,;
    1,1,1,1,78,{1118,1802,2020};
   },;
  {"Электрокардиография (в покое)","13.1.1",1,0,1,;
    {36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},; // для мужчин обязательно с 36 лет
    {45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},; // для женщин обязательно с 45 лет
    1,1,111,{110103,110303,110906,111006,111905,112212,112611,113418,113509,180202,2021};
   },;
  {"Спирометрия","16.1.717",2,0,1,; // "2.84.11"
    1,1,1,1,111,{110103,110303,110906,111006,111905,112212,112611,113418,113509,180202,2021};
   },;
  {"Дуплексное сканир-ие брахиоцефальных артерий","8.23.706",2,0,1,; // "2.84.1"
    1,1,1,1,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203};
   },;
  {"Ректосигмоколоноскопия диагностическая","10.6.710",{2,5},0,1,; // "2.84.6"
    1,1,1,1,123,{110104,111007,112221,112609,113419,113511},,arr2m_vozrast_DVN,arr2m_vozrast_DVN;
   },;
  {"Углубленное профилактическое консультирование","56.1.723",2,0,1,;
    1,1,1,1,{97,57,42},{1122,1110,2002};
   },;
  {"Приём врача невролога","2.84.1",2,1,0,;
    1,1,1,1,53,{1109};
   },;
  {"Приём врача офтальмолога","2.84.3",2,1,0,;
    1,1,1,1,65,{1112};
   },;
  {"Приём врача оториноларинголога","2.84.8",2,1,0,;
    1,1,1,1,162,{1111};
   },;
  {"Приём врача уролога (хирурга)","2.84.10",2,1,0,;
    1,1,1,0,{108,112},{112603,1126};
   },;
  {"Приём врача акушера-гинеколога","2.84.5",{2,5},1,0,;
    1,1,0,1,136,{1101},,0,arr2g_vozrast_DVN;
   },;
  {"Приём врача колопроктолога (хирурга)","2.84.6",{2,5},1,0,;
    1,1,1,1,{30,30,112},{112601,113503,1126},,arr2m_vozrast_DVN,arr2m_vozrast_DVN;
   },;
  {"Приём врача терапевта",{"2.3.5","2.84.11","2.3.2","2.3.6","2.84.11"},{1,2,3,4,5},1,0,;
    1,1,1,1,{97,57,42},{1122,1110,2002},;
    {{"2.3.2",57},{"2.3.2",97},{"2.3.3",42},{"2.3.5",57},{"2.3.5",97},{"2.3.6",57},{"2.3.6",97},;
     {"2.84.11",57},{"2.84.11",97}},1,1;
   };
 }
Public dvn_arr_usl := aclone(dvn_arr_usl18)
Public count_dvn_arr_usl := len(dvn_arr_usl)
//
Public dvn_2_etap := {; // обязательное сочетание услуг второго этапа
   {{"2.84.1"}, {"8.23.706"},45,90},; // невролог
   {{"2.84.11"},{"8.23.706"},45,90},; // терапевт
   {{"2.84.6"}, {"10.6.710","10.4.701"},40,75};  // колопроктолог
 }
//
Public dvn_arr_umolch18 := {; // услуги, записываемые всегда по умолчанию
  {"Опрос (анкетирование)","56.1.16",{1,3},1,1,1,1,0},;
  {"Измерение артериального давления","3.1.5",{1,3},1,1,1,1,0},;
  {"Антропометрия","3.1.19",{1,3},1,1,1,1,0},;
  {"Определение относительного суммарного сердечно-сосудистого риска","56.1.18",1,{21,39},{21,39},1,1,1},;
  {"Определение абсолютного суммарного сердечно-сосудистого риска","56.1.19",1,{42,63},{42,63},1,1,1},;
  {"Индивидуальное профилактическое консультирование","56.1.21",1,1,1,1,1,1},; // new
  {"Определение группы состояния здоровья","56.1.13",3,1,1,1,1,1},;
  {"Краткое профилактическое консультирование","56.1.14",3,1,1,1,1,1},;
  {"Определение суммарного сердечно-сосудистого риска","56.1.17",3,1,1,{18,65},{18,65},1};
 }
Public dvn_arr_umolch := aclone(dvn_arr_umolch18)
Public count_dvn_arr_umolch := len(dvn_arr_umolch)
//
Public dvn_700 := {; // какие услуги с ценой добавить к нулевым услугам
  {"2.3.5"   ,"2.90.3"  },; //приём терапевта дисп-ия 1 этап (1 раз в 3 года)
  {"2.3.6"   ,"2.90.4"  },; //приём терапевта дисп-ия 1 этап (1 раз в 2 года)
  {"2.3.3"   ,"2.90.2"  },; //посещение к фельдшеру
  {"3.4.9"   ,"3.4.709" },; //"Измерение внутриглазного давления"
  {"4.12.174","4.12.774"},; //"Исследование крови на общий холестерин"
  {"4.12.169","4.12.769"},; //"Исследование уровня глюкозы в крови"
  {"4.8.4"   ,"4.8.704" },; //"Исследование кала на скрытую кровь"
  {"4.14.66" ,"4.14.766"},; //"Кровь на простат-специфический антиген",
  {"4.1.12"  ,"4.1.712" },; //"Осмотр акушеркой, взятие мазка (соскоба)"
  {"4.20.1"  ,"4.20.701"},; //"Иссл-е взятого цитологического материала"
  {"7.57.3"  ,"7.57.703"},; //"Маммография"
  {"7.61.3"  ,"7.61.703"},; //"Флюорография лёгких"
  {"13.1.1"  ,"13.1.701"},; //"Электрокардиография"
  {"3.1.5"   ,"3.1.705" },; //"Измерение артериального давления"
  {"3.1.19"  ,"3.1.719" },; //"Антропометрия"
  {"56.1.16" ,"56.1.716"},; //"Опрос (анкетирование)"
  {"56.1.18" ,"56.1.718"},; //"Определение относительного суммарного сердечно-сосудистого риска"
  {"56.1.19" ,"56.1.719"},; //"Определение абсолютного суммарного сердечно-сосудистого риска"
  {"56.1.21" ,"56.1.721"};  //"Индивидуальное профилактическое консультирование"
 }
Public dvn_85 := {; // кол-во услуг, составляющих 85% - диспансеризация
  {7,6},{8,7},{9,8},{10,9},{11,9},{12,10},{13,11},{14,12},{15,13},{16,13},{17,14};
 }
Public prof_vn_85 := {; // кол-во услуг, составляющих 85% - профилактика
  {9,8},{10,9},{11,10},{12,11},{13,11},{14,12},{15,13},{16,14};
 }
// профилактика несовершеннолетних
Public np_arr_osmotr_KDP2 := {;  // замена на врачебные приёмы без гематологии
  {"2.85.1" ,"2.85.25","2.3.1",""       },;//   , "пульмонолог", 75, {113413,112208,112501} },;
  {"2.85.2" ,"2.85.26","2.3.1",""       },;//   , "дерматовенеролог", 16, {1104} },;
  {"2.85.3" ,"2.85.27","2.3.1",""       },;//   , "ревматолог", 77, {113414,112209} },;
  {"2.85.4" ,"2.85.28","2.3.1",""       },;//   , "аллерголог-иммунолог", 4, {113405,112214} },;
  {"2.85.5" ,"2.85.29","2.3.1",""       },;//   , "детский кардиолог", 17, {113403} },;
  {"2.85.6" ,"2.85.30","2.3.1",""       },;//   , "гастроэнтеролог", 11, {113407,112201} },;
  {"2.85.7" ,"2.85.31","2.3.1",""       },;//   , "нефролог", 56, {113412,112207} },;
  {"2.85.8" ,"2.85.32","2.3.1",""       },;//   , "гематолог", 12, {113408,112202} },;
  {"2.85.9" ,"2.85.33","2.3.1",""       },;//   , "инфекционист", 28, {1106} },;
  {"2.85.10","2.85.34","2.3.1",""       },;//   , "детский онколог", 18, {113401,112801,113501} },;
  {"2.85.11","2.85.35","2.3.1",""       },;//   , "нейрохирург", 54, {112602,113504} },;
  {"2.85.12","2.85.36","2.3.1",""       },;//   , "колопроктолог", 30, {112601,113503} },;
  {"2.85.13","2.85.37","2.3.1",""       },;//   , "сердечно-сосудистый хирург", 81, {112604,113505} },;
  {"2.85.14","2.85.38","2.3.2","2.91.1" },;//  "педиатр", 68,{1134}},;
  {"2.85.15","2.85.39","2.3.2","2.91.1" },;//  "врач общей практики", 57,{1110}},;
  {"2.85.16","2.85.40","2.3.1","2.91.8" },;//"Ж", "акушер-гинеколог", 136, {1101} },;
  {"2.85.17","2.85.41","2.3.1","2.91.9" },;//"М", "детский уролог-андролог", 19, {112603,113502} },;
  {"2.85.18","2.85.42","2.3.1","2.91.3" },;//   , "детский хирург", 20, {1135} },;
  {"2.85.19","2.85.43","2.3.1","2.91.6" },;//   , "травматолог-ортопед", 100, {1123} },;
  {"2.85.20","2.85.44","2.3.1","2.91.2" },;//   , "невролог", 53, {1109} },;
  {"2.85.21","2.85.45","2.3.1","2.91.4" },;//   , "офтальмолог", 65, {1112} },;
  {"2.85.22","2.85.46","2.3.1","2.91.7" },;//   , "отоларинголог", 162, {1111,111101} },;
  {"2.85.23","2.85.47","2.3.1","2.91.5" },;//   , "детский стоматолог", 86, {140102} },;
  {"2.85.24","2.85.48","2.3.1","2.91.10"}; //   , "детский эндокринолог", 21, {1127,112702,113402} },;
 }
Public np_arr_not_zs := {;  // замена на услуги с ценой (нет законченного случая)
  {"3.5.4",   "3.5.704",},;//
  {"4.2.153", "4.2.753",},;//
  {"4.11.136","4.11.736",},;//
  {"8.1.1",   "8.1.701",},;//
  {"8.1.3",   "8.1.703",},;//
  {"8.1.4",   "8.1.704",},;//
  {"8.1.6",   "8.1.706",},;//
  {"8.2.1",   "8.2.701",},;//
  {"13.1.1",  "13.1.701",};//
 }
Public np_arr_not_zs1 := {;  // замена на услуги с ценой (нет законченного случая)
  { 68,"2.91.1",},;//
  { 57,"2.91.1",},;//
  { 53,"2.91.2" },;//
  { 20,"2.91.3" },;//
  { 65,"2.91.4" },;//
  { 86,"2.91.5" },;//
  {100,"2.91.6" },;//
  {162,"2.91.7" },;//
  {136,"2.91.8" },;//
  { 19,"2.91.9" },;//
  { 21,"2.91.10"};//
 }
Public np_arr_osmotr := {;
  {"2.85.1" ,   , "пульмонолог", 75, {113413,112208,112501} },;
  {"2.85.2" ,   , "дерматовенеролог", 16, {1104} },;
  {"2.85.3" ,   , "ревматолог", 77, {113414,112209} },;
  {"2.85.4" ,   , "аллерголог-иммунолог", 4, {113405,112214} },;
  {"2.85.5" ,   , "детский кардиолог", 17, {113403} },;
  {"2.85.6" ,   , "гастроэнтеролог", 11, {113407,112201} },;
  {"2.85.7" ,   , "нефролог", 56, {113412,112207} },;
  {"2.85.8" ,   , "гематолог", 12, {113408,112202} },;
  {"2.85.9" ,   , "инфекционист", 28, {1106} },;
  {"2.85.10",   , "детский онколог", 18, {113401,112801,113501} },;
  {"2.85.11",   , "нейрохирург", 54, {112602,113504} },;
  {"2.85.12",   , "колопроктолог", 30, {112601,113503} },;
  {"2.85.13",   , "сердечно-сосудистый хирург", 81, {112604,113505} },;
  {"2.85.16","Ж", "акушер-гинеколог", 136, {1101} },;
  {"2.85.17","М", "детский уролог-андролог", 19, {112603,113502} },;
  {"2.85.18",   , "детский хирург", 20, {1135} },;
  {"2.85.19",   , "травматолог-ортопед", 100, {1123} },;
  {"2.85.20",   , "невролог", 53, {1109} },;
  {"2.85.21",   , "офтальмолог", 65, {1112} },;
  {"2.85.22",   , "отоларинголог", 162, {1111,111101} },;
  {"2.85.23",   , "детский стоматолог", 86, {1401,140102} },;
  {"2.85.24",   , "детский эндокринолог", 21, {1127,112702,113402} },;
  {"2.4.1"  ,   , "психиатр", {72,73}, {1115,111504} },;
  {"2.4.2"  ,   , "скрининг на выявление психич.развития", {68,57,72,73}, {1134,1110,1115,111504} };
 }
//"2.85.14"  педиатр 68,{1134}
//"2.85.15"  врач общей практики 57,{1110}
Public count_pn_arr_osm := len(np_arr_osmotr)
Public np_arr_issled := {;
  {"3.5.4"   ,   , "Аудиологический скрининг",0,{68,96,162},{1134,111101,1111} },;
  {"4.2.153" ,   , "Клинический анализ мочи",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.11.136",   , "Клинический анализ крови",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.26.1"  ,   , "Неонатальный скрининг на гипотиреоз",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.26.2"  ,   , "Неонатальный скрининг на фенилкетонурию",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.26.3"  ,   , "Неонатальный скрининг на адреногенитальный синдром",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.26.4"  ,   , "Неонатальный скрининг на муковисцидоз",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.26.5"  ,   , "Неонатальный скрининг на галактоземию",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"8.1.1"   ,   , "УЗИ головного мозга (нейросонография)",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.1.3"   ,   , "УЗИ сердца (эхокардиография)",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.1.4"   ,   , "УЗИ тазобедренных суставов",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.1.6"   ,   , "УЗИ почек",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.2.1"   ,   , "УЗИ органов брюшной полости (комплексное)",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"13.1.1"  ,   , "Электрокардиография",0,111,{110103,110303,110906,111006,111905,112212,112611,113418,113509,180202,2021} };
 }
Public count_pn_arr_iss := len(np_arr_issled)
Public np_arr_1_etap := {}
// 1-номер периода
// 2-начальный возраст {лет,месяцев} ( >= )
// 3-конечный возраст {лет,месяцев} ( < )
// 4-осмотры
// 5-исследования {шифр,N} при N=0 - обязательно, при N=1 - необязательно
aadd(np_arr_1_etap, { 1,{0,0},{0,1},;
                     {},;
                     {"4.26.1","4.26.2","4.26.3","4.26.4","4.26.5","3.5.4"}})
aadd(np_arr_1_etap, { 2,{0,1},{0,2},;
                     {"2.85.18","2.85.20","2.85.21","2.85.23"},;
                     {"8.1.1","8.1.3","8.1.4","8.1.6","8.2.1","3.5.4"}})
aadd(np_arr_1_etap, { 3,{0,2},{0,3},;
                     {},;
                     {"4.2.153","4.11.136"}})
aadd(np_arr_1_etap, { 4,{0,3},{0,4},;
                     {"2.85.19"},;
                     {"3.5.4"}})
aadd(np_arr_1_etap, { 5,{0,4},{0,5},;
                     {},;
                     {}})
aadd(np_arr_1_etap, { 6,{0,5},{0,6},;
                     {},;
                     {}})
aadd(np_arr_1_etap, { 7,{0,6},{0,7},;
                     {},;
                     {}})
aadd(np_arr_1_etap, { 8,{0,7},{0,8},;
                     {},;
                     {}})
aadd(np_arr_1_etap, { 9,{0,8},{0,9},;
                     {},;
                     {}})
aadd(np_arr_1_etap, {10,{0,9},{0,10},;
                     {},;
                     {}})
aadd(np_arr_1_etap, {11,{0,10},{0,11},;
                     {},;
                     {}})
aadd(np_arr_1_etap, {12,{0,11},{1,0},;
                     {},;
                     {}})
aadd(np_arr_1_etap, {13,{1,0},{1,1},;
                     {"2.85.18","2.85.19","2.85.20","2.85.21","2.85.22"},; // "2.85.21" с 1 сентября
                     {"4.2.153","4.11.136","13.1.1"}})
aadd(np_arr_1_etap, {14,{1,3},{1,4},;
                     {},;
                     {}})
aadd(np_arr_1_etap, {15,{1,6},{1,7},;
                     {},;
                     {}})
aadd(np_arr_1_etap, {16,{1,11},{2,1},;  // не позднее 31 декабря
                     {"2.85.23","2.4.1","2.4.2"},;
                     {}})
aadd(np_arr_1_etap, {17,{2,11},{4,0},;  // не позднее 31 декабря
                     {"2.85.20","2.85.18","2.85.23","2.85.21","2.85.22","2.85.16","2.85.17"},;
                     {"4.2.153","4.11.136"}})
aadd(np_arr_1_etap, {18,{4,0},{5,0},;
                     {"2.85.23"},;
                     {}})
aadd(np_arr_1_etap, {19,{5,0},{6,0},;
                     {"2.85.23"},;
                     {}})
aadd(np_arr_1_etap, {20,{6,0},{7,0},;
                     {"2.85.20","2.85.18","2.85.23","2.85.24","2.85.19","2.85.21","2.85.22","2.4.1","2.85.16","2.85.17"},;
                     {"4.2.153","4.11.136","8.2.1","8.1.3","8.1.6","13.1.1"}})
aadd(np_arr_1_etap, {21,{7,0},{8,0},;
                     {"2.85.20","2.85.23","2.85.21","2.85.22"},;
                     {"4.2.153","4.11.136"}})
aadd(np_arr_1_etap, {22,{8,0},{9,0},;
                     {"2.85.23"},;
                     {}})
aadd(np_arr_1_etap, {23,{9,0},{10,0},;
                     {"2.85.23"},;
                     {}})
aadd(np_arr_1_etap, {24,{10,0},{11,0},;
                     {"2.85.20","2.85.23","2.85.24","2.85.19","2.85.21"},;
                     {"4.2.153","4.11.136"}})
aadd(np_arr_1_etap, {25,{11,0},{12,0},;
                     {"2.85.23"},;
                     {}})
aadd(np_arr_1_etap, {26,{12,0},{13,0},;
                     {"2.85.23"},;
                     {}})
aadd(np_arr_1_etap, {27,{13,0},{14,0},;
                     {"2.85.23","2.85.21"},;
                     {}})
aadd(np_arr_1_etap, {28,{14,0},{15,0},;
                     {"2.85.23","2.85.16","2.85.17","2.4.1"},;
                     {}})
aadd(np_arr_1_etap, {29,{15,0},{16,0},;
                     {"2.85.18","2.85.23","2.85.17","2.85.24","2.85.20","2.85.19","2.85.21","2.85.22","2.85.16","2.4.1"},;
                     {"4.2.153","4.11.136","8.2.1","8.1.6","13.1.1"}})
aadd(np_arr_1_etap, {30,{16,0},{17,0},;
                     {"2.85.18","2.85.23","2.85.17","2.85.24","2.85.20","2.85.19","2.85.21","2.85.22","2.85.16","2.4.1"},;
                     {"4.2.153","4.11.136"}})
aadd(np_arr_1_etap, {31,{17,0},{18,0},;
                     {"2.85.18","2.85.23","2.85.17","2.85.24","2.85.20","2.85.19","2.85.21","2.85.22","2.85.16","2.4.1"},;
                     {"4.2.153","4.11.136","13.1.1"}})
Init_Program_old_func()
return NIL


** 27.01.18 инициализация программы
Function Init_Program_old_func()
// диспансеризация взрослого населения 2013 год
Public dvn_arr_usl13 := {; // Услуги на экран для ввода
  {"Измерение внутриглазного давления","3.4.9",1,0,1,;
    {39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    {39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    1,1,65,{1112};
   },;
  {"Исследование крови на общий холестерин","4.12.174",{1,3},0,1,;
    {21,24,27,30,33,36,42,48,54,60,66,72,78,84,90,96},;
    {21,24,27,30,33,36,42,48,54,60,66,72,78,84,90,96},;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Исследование уровня глюкозы в крови","4.12.169",{1,3},0,1,;
    {21,24,27,30,33,36,42,48,54,60,66,72,78,84,90,96},;
    {21,24,27,30,33,36,42,48,54,60,66,72,78,84,90,96},;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Клинический анализ мочи","4.2.153",1,0,1,;
    1,1,1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Клинический анализ крови (3 показателя)","4.11.137",{1,3},0,1,;
    {21,24,27,30,33,36,42,48,54,60,66,72,78,84,90,96},;
    {21,24,27,30,33,36,42,48,54,60,66,72,78,84,90,96},;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Клинический анализ крови (развёрнутый)","4.11.136",1,0,1,;
    {39,45,51,57,63,69,75,81,87,93,99},;
    {39,45,51,57,63,69,75,81,87,93,99},;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Биохимический общетерапевтическ.анализ крови","4.12.172",1,0,1,;
    {39,45,51,57,63,69,75,81,87,93,99},;
    {39,45,51,57,63,69,75,81,87,93,99},;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Кровь на простат-специфический антиген","4.14.66",1,0,1,;
    {51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    0,;
    1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Исследование кала на скрытую кровь","4.8.4",{1,3},0,1,;
    {45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    {45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    {46,98},{46,98},34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Иссл-е взятого цитологического материала","4.20.1",1,0,1,;
    0,1,1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Маммография","7.57.3",{1,3},0,1,;
    0,;
    {39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99},;
    0,{40,98},78,{1118,1802,2020};
   },;
  {"Флюорография лёгких","7.61.3",{1,3},0,1,;
    1,1,1,1,78,{1118,1802,2020};
   },;
  {"УЗИ органов брюшной полости","8.2.1",1,0,1,;
    {39,45,51,57,63,69,75,81,87,93,99},;
    {39,45,51,57,63,69,75,81,87,93,99},;
    1,1,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203};
   },;
  {"Электрокардиография","13.1.1",1,0,1,;
    -36,; // для мужчин обязательно с 36 лет
    -45,; // для женщин обязательно с 45 лет
    1,1,111,{110103,110303,110906,111006,111905,112212,112611,113418,113509,180202,2021};
   },;
  {"Определение гликированного гемоглобина крови","4.12.170",2,0,1,; // "2.84.2"
    1,1,1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Тест на толерантность к глюкозе","4.12.171",2,0,1,; // "2.84.2"
    1,1,1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Исследование липидного спектра крови","4.12.173",2,0,1,; // "2.84.2"
    1,1,1,1,34,{1107,1301,1402,1702,1801,2011,2013};
   },;
  {"Дуплексное сканир-ие брахиоцефальных артерий","8.23.6",2,0,1,; // "2.84.1"
    1,1,1,1,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203};
   },;
  {"Фиброэзофагогастродуоденоскопия","10.3.13",2,0,1,; // "2.84.2"
    1,1,1,1,123,{110104,111007,112221,112609,113419,113511};
   },;
  {"Ректоскопия диагностическая","10.4.1",2,0,1,; // "2.84.6"
    1,1,1,1,123,{110104,111007,112221,112609,113419,113511};
   },;
  {"Ректосигмоколоноскопия диагностическая","10.6.10",2,0,1,; // "2.84.6"
    1,1,1,1,123,{110104,111007,112221,112609,113419,113511};
   },;
  {"Приём врача невролога",{"2.3.1","2.84.1"},{1,2},1,0,;
    {51,57,63,69,75,81,87,93,99},;
    {51,57,63,69,75,81,87,93,99},;
    1,1,53,{1109},;
    {{"2.3.1",53},{"2.84.1",53}};
   },;
  {"Приём врача офтальмолога","2.84.3",2,1,0,;
    1,1,1,1,65,{1112};
   },;
  {"Приём врача уролога (хирурга)","2.84.4",2,1,0,;
    1,1,1,0,{108,112},{112603,1126};
   },;
  {"Приём врача акушера-гинеколога","2.84.5",2,1,0,;
    1,1,0,1,136,{1101};
   },;
  {"Приём врача колопроктолога (хирурга)","2.84.6",2,1,0,;
    1,1,1,1,{30,30,112},{112601,113503,1126};
   },;
  {"Приём врача терапевта",{"2.3.1","2.84.2","2.3.1"},{1,2,3},1,0,;
    1,1,1,1,{97,57,42},{1122,1110,2002},;
    {{"2.3.1",97},{"2.3.2",57},{"2.84.2",97},{"2.84.2",57},{"2.84.7",97},{"2.84.7",57},{"2.3.3",42}};
   };
 }
Public count_dvn_arr_usl13 := len(dvn_arr_usl13)
//
Public dvn_2_etap13 := {; // обязательное сочетание услуг второго этапа
   {"2.84.1",{"8.23.6"}},;
   {"2.84.2",{"4.12.170","4.12.171","4.12.173","10.3.13"}},;
   {"2.84.6",{"10.4.1","10.6.10"}};
 }
//
Public dvn_arr_umolch13 := {; // услуги, записываемые всегда по умолчанию
  {"Опрос (анкетирование)","56.1.16",{1,3},1,1,1,1,0},;
  {"Измерение артериального давления","3.1.5",{1,3},1,1,1,1,0},;
  {"Антропометрия","3.1.19",{1,3},1,1,1,1,0},;
  {"Определение группы состояния здоровья,...","56.1.13",{1,2,3},1,1,1,1,1},;
  {"Краткое профилактическое консультирование","56.1.14",{1,3},1,1,1,1,1},; //!
  {"Развернутое профилактическое консультирование","56.1.15",2,1,1,1,1,1},; //!
  {"Определение суммарного сердечно-сосудистого риска","56.1.17",{1,3},;
    {21,24,27,30,33,36,39,42,45,48,51,54,57,60,63},;
    {21,24,27,30,33,36,39,42,45,48,51,54,57,60,63},;
    {18,65},{18,65},1;
   };
 }
Public count_dvn_arr_umolch13 := len(dvn_arr_umolch13)
//
Public dvn_85_13 := {; // кол-во услуг, составляющих 85%
  {9,8},{10,9},{11,10},{12,11},{13,11},{14,12},{15,13},{16,14};
 }
// предварительные осмотры несовершеннолетних
Public npred_arr_osmotr_KDP2 := {;  // замена на врачебные приёмы без гематологии
  {"2.86.1" ,"2.86.25"},;//   , "пульмонолог", 75, {113413,112208,112501} },;
  {"2.86.2" ,"2.86.26"},;//   , "дерматовенеролог", 16, {1104} },;
  {"2.86.3" ,"2.86.27"},;//   , "ревматолог", 77, {113414,112209} },;
  {"2.86.4" ,"2.86.28"},;//   , "аллерголог-иммунолог", 4, {113405,112214} },;
  {"2.86.5" ,"2.86.29"},;//   , "детский кардиолог", 17, {113403} },;
  {"2.86.6" ,"2.86.30"},;//   , "гастроэнтеролог", 11, {113407,112201} },;
  {"2.86.7" ,"2.86.31"},;//   , "нефролог", 56, {113412,112207} },;
  {"2.86.8" ,"2.86.32"},;//   , "гематолог", 12, {113408,112202} },;
  {"2.86.9" ,"2.86.33"},;//   , "инфекционист", 28, {1106} },;
  {"2.86.10","2.86.34"},;//   , "детский онколог", 18, {113401,112801,113501} },;
  {"2.86.11","2.86.35"},;//   , "нейрохирург", 54, {112602,113504} },;
  {"2.86.12","2.86.36"},;//   , "колопроктолог", 30, {112601,113503} },;
  {"2.86.13","2.86.37"},;//   , "сердечно-сосудистый хирург", 81, {112604,113505} },;
  {"2.86.14","2.86.38"},;//  "педиатр", 68,{1134}},;
  {"2.86.15","2.86.39"},;//  "врач общей практики", 57,{1110}},;
  {"2.86.16","2.86.40"},;//"Ж", "акушер-гинеколог", 136, {1101} },;
  {"2.86.17","2.86.41"},;//"М", "детский уролог-андролог", 19, {112603,113502} },;
  {"2.86.18","2.86.42"},;//   , "детский хирург", 20, {1135} },;
  {"2.86.19","2.86.43"},;//   , "травматолог-ортопед", 100, {1123} },;
  {"2.86.20","2.86.44"},;//   , "невролог", 53, {1109} },;
  {"2.86.21","2.86.45"},;//   , "офтальмолог", 65, {1112} },;
  {"2.86.22","2.86.46"},;//   , "отоларинголог", 162, {1111,111101} },;
  {"2.86.23","2.86.47"},;//   , "детский стоматолог", 86, {1401,140102} },;
  {"2.86.24","2.86.48"}; //   , "детский эндокринолог", 21, {1127,112702,113402} },;
 }
Public npred_arr_osmotr := {;
  {"2.86.1" ,   , "пульмонолог", 75, {113413,112208,112501} },;
  {"2.86.2" ,   , "дерматовенеролог", 16, {1104} },;
  {"2.86.3" ,   , "ревматолог", 77, {113414,112209} },;
  {"2.86.4" ,   , "аллерголог-иммунолог", 4, {113405,112214} },;
  {"2.86.5" ,   , "детский кардиолог", 17, {113403} },;
  {"2.86.6" ,   , "гастроэнтеролог", 11, {113407,112201} },;
  {"2.86.7" ,   , "нефролог", 56, {113412,112207} },;
  {"2.86.8" ,   , "гематолог", 12, {113408,112202} },;
  {"2.86.9" ,   , "инфекционист", 28, {1106} },;
  {"2.86.10",   , "детский онколог", 18, {113401,112801,113501} },;
  {"2.86.11",   , "нейрохирург", 54, {112602,113504} },;
  {"2.86.12",   , "колопроктолог", 30, {112601,113503} },;
  {"2.86.13",   , "сердечно-сосудистый хирург", 81, {112604,113505} },;
  {"2.86.16","Ж", "акушер-гинеколог", 136, {1101} },;
  {"2.86.17","М", "детский уролог-андролог", 19, {112603,113502} },;
  {"2.86.18",   , "детский хирург", 20, {1135} },;
  {"2.86.19",   , "травматолог-ортопед", 100, {1123} },;
  {"2.86.20",   , "невролог", 53, {1109} },;
  {"2.86.21",   , "офтальмолог", 65, {1112} },;
  {"2.86.22",   , "отоларинголог", 162, {1111,111101} },;
  {"2.86.23",   , "детский стоматолог", 86, {1401,140102} },;
  {"2.86.24",   , "детский эндокринолог", 21, {1127,112702,113402} },;
  {"2.4.1"  ,   , "психиатр", 72, {1115} };
 }
//"2.86.14"  педиатр 68,{1134}
//"2.86.15"  врач общей практики 57,{1110}
Public count_predn_arr_osm := len(npred_arr_osmotr)
Public npred_arr_issled := {;
  {"4.2.153" ,   , "Общий анализ мочи",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.11.136",   , "Клинический анализ крови",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.12.169",   , "Иссл-ние уровня глюкозы в крови",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.8.12"  ,   , "Анализ кала на яйца глистов",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"7.61.3"  ,   , "Флюорография легких в 1-й проекции",0,78,{1118,1802,2020} },;
  {"8.1.2"   ,   , "УЗИ щитовидной железы",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.1.3"   ,   , "УЗИ сердца",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.2.1"   ,   , "УЗИ органов брюшной полости",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.2.2"   ,"М", "УЗИ органов репродуктивной системы",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"8.2.3"   ,"Ж", "УЗИ органов репродуктивной системы",0,106,{110101,111004,111802,111903,112211,112610,113416,113508,180203} },;
  {"13.1.1"  ,   , "Электрокардиография",0,111,{110103,110303,110906,111006,111905,112212,112611,113418,113509,180202,2021} },;
  {"56.1.13" ,   , "Определение группы состояния здоровья,...",2,0,{1,2} };
 }
Public count_predn_arr_iss := len(npred_arr_issled)
Public npred_arr_1_etap := {}
// 1-номер периода
// 2-начальный возраст
// 3-конечный возраст
// 4-осмотры
// 5-исследования {шифр,N} при N=0 - обязательно, при N=1 - необязательно
// 6-наименование периода
aadd(npred_arr_1_etap, {1,0,17,;
                       {"2.86.16","2.86.17","2.86.18","2.86.20","2.86.21","2.86.22","2.86.23","2.4.1"},;
                       {"4.2.153","4.11.136","4.12.169","4.8.12"},;
                       "ДОУ"})
aadd(npred_arr_1_etap, {0,0,17,;
                       {"2.86.16","2.86.17","2.86.18","2.86.19","2.86.20","2.86.21","2.86.22","2.86.23","2.4.1"},;
                       {"4.2.153","4.11.136","4.12.169","4.8.12","8.1.2","8.1.3","8.2.1","8.2.2","8.2.3","13.1.1"},;
                       "ООУ"})
aadd(npred_arr_1_etap, {2,0,14,;
                       {"2.86.16","2.86.17","2.86.18","2.86.19","2.86.20","2.86.21","2.86.22","2.86.23","2.86.24","2.4.1"},;
                       {"4.2.153","4.11.136","4.12.169","8.1.2","8.1.3","8.2.1","8.2.2","8.2.3","13.1.1"},;
                       "ОУ НПО, ВПО, СОУ,...0-14 лет"})
aadd(npred_arr_1_etap, {2,15,17,;
                       {"2.86.16","2.86.17","2.86.18","2.86.19","2.86.20","2.86.21","2.86.22","2.86.23","2.86.24","2.4.1"},;
                       {"4.2.153","4.11.136","4.12.169","8.1.2","8.1.3","8.2.1","8.2.2","8.2.3","13.1.1","7.61.3"},;
                       "ОУ НПО, ВПО, СОУ,...15-17 лет"})
// периодические осмотры несовершеннолетних
//"2.3.1"  педиатр 68,{1134}
//"2.3.2"  врач общей практики 57,{1110}
Public nper_arr_issled := {;
  {"4.2.153" ,   , "Общий анализ мочи",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"4.11.136",   , "Клинический анализ крови",0,34,{1107,1301,1402,1702,1801,2011,2013} },;
  {"16.1.16" ,   , "Анализ окиси углерода выдыхаем.воздуха",0,34,{1107,1301,1402,1702,1801,2011,2013} };
 }
Public count_pern_arr_iss := len(nper_arr_issled)
Public nper_arr_1_etap := {}
// 1-номер периода
// 2-начальный возраст
// 3-конечный возраст
// 4-осмотры
// 5-исследования {шифр,N} при N=0 - обязательно, при N=1 - необязательно
// 6-наименование периода
aadd(nper_arr_1_etap, {1,0,17,;
                      {},;
                      {"4.2.153","4.11.136"},;
                      "ДОУ"})
aadd(nper_arr_1_etap, {0,0,17,;
                      {},;
                      {"4.2.153","4.11.136","16.1.16"},;
                      "ООУ и ОУ НПО, ВПО, СОУ"})
return NIL

** 09.06.15 функция проверки лицензии на диспансеризацию/профилактику
Function license_for_dispans(_tip,_n_data,_ta)
// список учреждений с датой лицензии на диспансеризацию
Static arr_date_disp := {;
  {101003,1,0,20130726},;  // 101003;ГБУЗ "ВОКБ № 3";+;;26.07.2013
  {114504,1,0,20130705},;  // 114504;ГУЗ "Поликлиника № 4";+;;05.07.2013
  {114506,1,0,20130704},;  // 114506;ГУЗ "Поликлиника № 6";+;;04.07.2013
  {115506,0,1,20130718},;  // 115506;ГУЗ "Детская поликлиника № 6";;+;18.07.2013
  {115510,0,1,20130719},;  // 115510;ГУЗ "ДП № 10";;+;19.07.2013
  {121018,1,1,20130806},;  // 121018;ГУЗ "Больница № 18";+;+;06.08.2013
  {124501,1,1,20130829},;  // 124501;ГУЗ "Гумракская амбулатория";+;+;29.08.2013
  {124528,1,1,20130805},;  // 124528;ГУЗ "Клиническая поликлиника № 28";+;+;05.08.2013
  {124530,1,1,20130703},;  // 124530;ГУЗ "Поликлиника № 30";+;+;03.07.2013
  {125505,0,1,20130719},;  // 125505;ГУЗ "Детская поликлиника № 5";;+;19.07.2013
  {131020,0,1,20130718},;  // 131020;ГУЗ "КДЦ для детей № 1";;+;18.07.2013
  {134505,1,0,20130719},;  // 134505;ГУЗ "Поликлиника № 5";+;;19.07.2013
  {134510,1,0,20130729},;  // 134510;ГУЗ "Поликлиника № 10";+;;29.07.2013
  {135509,0,1,20130805},;  // 135509;ГУЗ "Детская поликлиника № 9";;+;05.08.2013
  {141016,1,0,20130725},;  // 141016;ГУЗ "Больница № 16";+;;25.07.2013
  {141022,1,0,20130726},;  // 141022;ГУЗ "Больница №22";+;;26.07.2013
  {141023,1,0,20130712},;  // 141023;ГУЗ "КБСМП № 15";+;;12.07.2013
  {141024,1,0,20130712},;  // 141024;ГУЗ "Больница № 24";+;;12.07.2013
  {145516,0,1,20130729},;  // 145516;ГУЗ "Детская поликлиника № 16";;+;29.07.2013
  {145526,0,1,20130727},;  // 145526;ГУЗ "Детская поликлиника № 26";;+;27.07.2013
  {154602,1,0,20130701},;  // 154602;ГУЗ "Поликлиника № 2";+;;01.07.2013
  {154608,1,0,20130729},;  // 154608;ГУЗ "Поликлиника № 8";+;;29.07.2013
  {154620,1,0,20130802},;  // 154620;ГУЗ "Поликлиника № 20";+;;02.08.2013
  {155502,0,1,20130730},;  // 155502;ГУЗ "Детская поликлиника № 2";;+;30.07.2013
  {155601,0,1,20130729},;  // 155601;ГУЗ "Детская поликлиника № 1";;+;29.07.2013
  {161007,1,0,20130725},;  // 161007;ГУЗ "КБ СМП № 7";+;;25.07.2013
  {161015,1,0,20130801},;  // 161015;ГУЗ "Клиническая больница № 11";+;;01.08.2013
  {165525,0,1,20130802},;  // 165525;ГУЗ "Детская поликлиника № 25";;+;02.08.2013
  {165531,0,1,20130801},;  // 165531;ГУЗ "ДКП № 31";;+;01.08.2013
  {174601,1,0,20130718},;  // 174601;ГУЗ КП № 1;+;;18.07.2013
  {175603,0,1,20130725},;  // 175603;ГУЗ "Детская поликлиника № 3";;+;25.07.2013
  {175617,0,1,20130729},;  // 175617;ГУЗ "ДП № 17";;+;29.07.2013
  {175627,0,1,20130806},;  // 175627;ГУЗ "Детская поликлиника № 27";;+;06.08.2013
  {175709,1,0,20130624},;  // 175709;ГУЗ "Клиническая поликлиника № 9";+;;24.06.2013
  {184512,1,0,20130701},;  // 184512;ГУЗ "Клиническая поликлиника № 12";+;;01.07.2013
  {184603,1,0,20130701},;  // 184603;ГУЗ "Клиническая поликлиника №3";+;;01.07.2013
  {185515,0,1,20130730},;  // 185515;ГУЗ "ДКП № 15";;+;30.07.2013
  {251001,1,1,20130713},;  // 251001;ГБУЗ "ГКБ № 1 им. С.З.Фишера";+;;13.07.2013
  {251002,1,0,20130705},;  // 251002;ГБУЗ "ГКБ №3";+;;05.07.2013
  {251003,1,0,20130730},;  // 251003;ГБУЗ "Городская больница № 2";+;;30.07.2013
  {251008,0,1,20130805},;  // 251008;ГБУЗ "Городская детская больница";;+;05.08.2013
  {254504,1,0,20130705},;  // 254504;ГБУЗ "Поликлиника № 4";+;;05.07.2013
  {254505,1,0,20130711},;  // 254505;ГБУЗ "Городская поликлиника №5";+;;11.07.2013
  {254506,0,1,20130809},;  // 254506;ГБУЗ "Городская поликлиника № 6";;+;09.08.2013
  {255601,0,1,20130802},;  // 255601;ГБУЗ "ГДП № 1";;+;02.08.2013
  {255627,0,1,20130730},;  // 255627;ГБУЗ "ГДП №2";;+;30.07.2013
  {255802,1,0,20130703},;  // 255802;ГБУЗ "Городская поликлиника № 3";+;;03.07.2013
  {301001,1,1,20130730},;  // 301001;ГБУЗ "Алексеевская ЦРБ";+;+;30.07.2013
  {311001,1,1,20130813},;  // 311001;ГБУЗ "Быковская ЦРБ";+;+;13.08.2013
  {321001,1,1,20130802},;  // 321001;ГБУЗ "Городищенская ЦРБ";+;+;02.08.2013
  {331001,1,1,20130709},;  // 331001;ГБУЗ "Даниловская ЦРБ";+;+;09.07.2013
  {341001,1,1,20130802},;  // 341001;ГБУЗ "ЦРБ Дубовского муниципального района";+;+;02.08.2013
  {351001,1,1,20130730},;  // 351001;ГБУЗ Еланская ЦРБ;+;+;30.07.2013
  {361001,1,1,20130801},;  // 361001;ГУЗ "Жирновская ЦРБ";+;+;01.08.2013
  {371001,1,1,20130805},;  // 371001;ГБУЗ "Иловлинская ЦРБ";+;+;05.08.2013
  {381001,1,1,20130829},;  // 381001;ГБУЗ "Калачевская ЦРБ";+;+;29.08.2013
  {391001,1,0,20130802},;  // 391001;ГБУЗ г.Камышина "Городская больница № 1";+;;02.08.2013
  {391002,1,0,20130802},;  // 391002;ГБУЗ ЦГБ;+;;02.08.2013
  {391003,0,1,20130805},;  // 391003;ГБУЗ "КДГБ";;+;05.08.2013
  {391015,0,1,20131114},;  //+391015;ЦРБ Камышинского р-на;;+;14.11.2013
  {395501,0,1,20130809},;  // 395501;ГБУЗ "Детская поликлиника Камышинского муниципального района Волгоградской области
  {401001,1,1,20130801},;  // 401001;ГБУЗ "Киквидзенская ЦРБ";+;+;01.08.2013
  {411001,1,1,20130713},;  // 411001;ГБУЗ "ЦРБ Клетского муниципального района";+;+;13.07.2013
  {421001,1,1,20130806},;  // 421001;ГБУЗ "Котельниковская ЦРБ";+;+;06.08.2013
  {431001,1,1,20130809},;  // 431001;ГБУЗ ЦРБ Котовского муниципального района;+;+;09.08.2013
  {441001,1,1,20130809},;  // 441001;ГБУЗ "Ленинская ЦРБ";+;+;09.08.2013
  {451001,1,0,20130805},;  // 451001;ГБУЗ "МЦРБ";+;;05.08.2013
  {451002,0,1,20130717},;  // 451002;ГБУЗ "МГДБ";;+;17.07.2013
  {461001,1,1,20130718},;  // 461001;ГБУЗ "Нехаевская ЦРБ";+;+;18.07.2013
  {471001,1,1,20130717},;  // 471001;ГБУЗ "Николаевская ЦРБ";+;+;17.07.2013
  {481001,1,1,20130801},;  // 481001;ГБУЗ "Новоаннинская ЦРБ";+;+;01.08.2013
  {491001,1,1,20130802},;  // 491001;ГБУЗ "Новониколаевская ЦРБ";+;+;02.08.2013
  {501001,1,1,20130806},;  // 501001;ГБУЗ "Октябрьская ЦРБ";+;+;06.08.2013
  {511001,1,1,20130809},;  // 511001;ГБУЗ "ЦРБ Ольховского муниципального района";+;+;09.08.2013
  {521001,1,1,20130716},;  // 521001;ГБУЗ "Палласовская ЦРБ";+;+;16.07.2013
  {531001,1,1,20130724},;  // 531001;ГБУЗ "Кумылженская ЦРБ";+;+;24.07.2013
  {541001,1,1,20130813},;  // 541001;ГБУ "ЦРБ Руднянского муниципального района";+;+;13.08.2013
  {551001,1,1,20130809},;  // 551001;ГБУЗ "Светлоярская ЦРБ";+;+;09.08.2013
  {561001,1,1,20130717},;  // 561001;ГБУЗ "Серафимовичская ЦРБ";+;+;17.07.2013
  {571001,1,1,20130802},;  // 571001;ГБУЗ "Среднеахтубинская ЦРБ";+;+;02.08.2013
  {571002,1,0,20130829},;  // 571002;ГБУЗ "Краснослободская городская больница";+;;29.08.2013
  {581001,1,1,20130711},;  // 581001;ГБУЗ "Старополтавская ЦРБ";+;+;11.07.2013
  {591001,1,1,20130730},;  // 591001;ГБУЗ "ЦРБ Суровикинского муниципального района";+;+;30.07.2013
  {601001,1,1,20130809},;  // 601001;ГБУЗ Урюпинская ЦРБ;+;+;09.08.2013
  {611001,1,1,20130802},;  // 611001;ГБУЗ "Фроловская ЦРБ";+;+;02.08.2013
  {621001,1,1,20130805},;  // 621001;ГБУЗ "Чернышковская ЦРБ";+;+;05.08.2013
  {711001,1,0,20130731};   // 711001;НУЗ "Отделенческая клиническая больница на ст. Волгоград-1 ОАО "РЖД";+;;31.07.2013
 }
Static mm_tip := {"диспансеризацию/профилактику взрослых",;
                  "профилактику несовершеннолетних"}
Local i
if valtype(arr_date_disp[1,1]) == "N" // для первого запуска
  for i := 1 to len(arr_date_disp)
    arr_date_disp[i,1] := lstr(arr_date_disp[i,1])
    arr_date_disp[i,4] := stod(lstr(arr_date_disp[i,4]))
  next
endif
if (i := ascan(arr_date_disp, {|x| x[1] == glob_mo[_MO_KOD_TFOMS] })) > 0
  if arr_date_disp[i,_tip+1] == 0
    aadd(_ta,'У Вашей МО нет лицензии на '+mm_tip[_tip])
  elseif arr_date_disp[i,4] > _n_data
    aadd(_ta,'У Вашей МО лицензия на '+mm_tip[_tip]+' с '+date_8(arr_date_disp[i,4])+'г.')
  endif
else
  aadd(_ta,'У Вашей МО нет лицензии на '+mm_tip[_tip])
endif
return NIL

** 25.08.13 если услуга из 1 этапа
Function is_issled_PerN(ausl,_period,arr,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s := "", fl := .f., lshifr := alltrim(ausl[1])
for i := 1 to count_pern_arr_iss
  if nper_arr_issled[i,1] == lshifr
    s := '"'+lshifr+'.'+nper_arr_issled[i,3]+'"'
    fl := .t.
    exit
  endif
next
if fl .and. nper_arr_issled[i,4] < 2
  if nper_arr_issled[i,5] != ausl[3]
    aadd(arr,'Не тот профиль в иссл-ии '+s)
  endif
  /*if ascan(nper_arr_issled[i,6],ausl[4]) == 0
    aadd(arr,'Не та специальность врача в иссл-ии '+s)
    aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(nper_arr_issled[i,6]))
  endif*/
endif
return fl

** 19.08.13 если услуга из 1 этапа
Function is_1_etap_PredN(ausl,_period,_etap)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s, fl := .f., lshifr := alltrim(ausl[1])
for i := 1 to count_predn_arr_osm
  if _etap == 1
    if npred_arr_osmotr[i,4] == ausl[3]
      lshifr := npred_arr_osmotr[i,1] // искусственно
      fl := .t. ; exit
    endif
  else
    if npred_arr_osmotr[i,1] == lshifr
      fl := .t. ; exit
    endif
  endif
next
if fl
  fl := (ascan(npred_arr_1_etap[_period,4],lshifr) > 0)
endif
return fl

** 13.02.17
Function is_osmotr_PredN(ausl,_period,arr,_etap,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s, fl := .f., lshifr := alltrim(ausl[1])
if _etap == 2 .and. (j := ascan(npred_arr_osmotr_KDP2,{|x| x[2] == lshifr})) > 0
  lshifr := npred_arr_osmotr_KDP2[j,1]
endif
for i := 1 to count_predn_arr_osm
  if _etap == 1
    if npred_arr_osmotr[i,4] == ausl[3]
      lshifr := npred_arr_osmotr[i,1] // искусственно
      fl := .t. ; exit
    endif
  else
    if npred_arr_osmotr[i,1] == lshifr
      fl := .t. ; exit
    endif
  endif
next
if fl
  s := '"'+lshifr+'.'+npred_arr_osmotr[i,3]+'"'
  if _etap == 1 .and. ascan(npred_arr_1_etap[_period,4],lshifr) == 0
    aadd(arr,'Некорректный возрастной период пациента для '+s)
  endif
  if !empty(npred_arr_osmotr[i,2]) .and. !(npred_arr_osmotr[i,2] == _pol)
    aadd(arr,'Несовместимость по полу в услуге '+s)
  endif
  if npred_arr_osmotr[i,4] != ausl[3]
    aadd(arr,'Не тот профиль в услуге '+s)
  endif
  /*if ascan(npred_arr_osmotr[i,5],ausl[4]) == 0
    aadd(arr,'Не та специальность врача в услуге '+s)
    aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(npred_arr_osmotr[i,5]))
  endif*/
endif
return fl

** 19.08.13
Function is_issled_PredN(ausl,_period,arr,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s := "", fl := .f., lshifr := alltrim(ausl[1])
for i := 1 to count_predn_arr_iss
  if npred_arr_issled[i,1] == lshifr
    s := '"'+lshifr+'.'+npred_arr_issled[i,3]+'"'
    if valtype(npred_arr_issled[i,2]) == "C" .and. !(npred_arr_issled[i,2] == _pol)
      aadd(arr,'Несовместимость по полу в услуге '+s)
    endif
    fl := .t.
    exit
  endif
next
if fl .and. npred_arr_issled[i,4] < 2
  if ascan(npred_arr_1_etap[_period,5],lshifr) == 0
    aadd(arr,'Некорректный возрастной период пациента для '+s)
  endif
  if npred_arr_issled[i,5] != ausl[3]
    aadd(arr,'Не тот профиль в иссл-ии '+s)
  endif
  /*if ascan(npred_arr_issled[i,6],ausl[4]) == 0
    aadd(arr,'Не та специальность врача в иссл-ии '+s)
    aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(npred_arr_issled[i,6]))
  endif*/
endif
return fl

** 06.11.19 если услуга из 1 этапа
Function is_1_etap_PN(ausl,_period,_etap)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s, fl := .f., fl_profil := .f., lshifr := alltrim(ausl[1])
if eq_any(left(lshifr,4),"2.3.","2.91")
  fl_profil := .t.
elseif _etap == 1
  if (i := ascan(np_arr_not_zs,{|x| x[2] == lshifr})) > 0
    lshifr := np_arr_not_zs[i,1]
  endif
elseif (i := ascan(np_arr_osmotr_KDP2,{|x| x[2] == lshifr})) > 0
  lshifr := np_arr_osmotr_KDP2[i,1]
endif
for i := 1 to count_pn_arr_osm
  if _etap == 1 .or. fl_profil
    if valtype(np_arr_osmotr[i,4]) == "N"
      if np_arr_osmotr[i,4] == ausl[3]
        lshifr := np_arr_osmotr[i,1] // искусственно
        fl := .t. ; exit
      endif
    elseif (j := ascan(np_arr_osmotr[i,4],ausl[3])) > 0
      lshifr := np_arr_osmotr[i,1] // искусственно
      fl := .t. ; exit
    endif
  else
    if np_arr_osmotr[i,1] == lshifr
      fl := .t. ; exit
    endif
  endif
next
if fl
  fl := (ascan(np_arr_1_etap[_period,4],lshifr) > 0)
endif
return fl

** 06.11.19
Function is_osmotr_PN(ausl,_period,arr,_etap,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s, fl := .f., fl_profil := .f., lshifr := alltrim(ausl[1])
if eq_any(left(lshifr,4),"2.3.","2.91")
  fl_profil := .t.
elseif _etap == 1
  if (i := ascan(np_arr_not_zs,{|x| x[2] == lshifr})) > 0
    lshifr := np_arr_not_zs[i,1]
  endif
elseif (i := ascan(np_arr_osmotr_KDP2,{|x| x[2] == lshifr})) > 0
  lshifr := np_arr_osmotr_KDP2[i,1]
endif
for i := 1 to count_pn_arr_osm
  if _etap == 1 .or. fl_profil
    if valtype(np_arr_osmotr[i,4]) == "N"
      if np_arr_osmotr[i,4] == ausl[3]
        lshifr := np_arr_osmotr[i,1] // искусственно
        fl := .t. ; exit
      endif
    elseif (j := ascan(np_arr_osmotr[i,4],ausl[3])) > 0
      lshifr := np_arr_osmotr[i,1] // искусственно
      fl := .t. ; exit
    endif
  else
    if np_arr_osmotr[i,1] == lshifr
      fl := .t. ; exit
    endif
  endif
next
if fl
  s := '"'+lshifr+'.'+np_arr_osmotr[i,3]+'"'
  if _etap == 1 .and. ascan(np_arr_1_etap[_period,4],lshifr) == 0
    aadd(arr,'Некорректный возрастной период пациента для '+s)
  endif
  if !empty(np_arr_osmotr[i,2]) .and. !(np_arr_osmotr[i,2] == _pol)
    aadd(arr,'Несовместимость по полу в услуге '+s)
  endif
  if valtype(np_arr_osmotr[i,4]) == "N"
    if np_arr_osmotr[i,4] != ausl[3]
      aadd(arr,'Не тот профиль в услуге '+s)
    endif
  elseif (j := ascan(np_arr_osmotr[i,4],ausl[3])) == 0
    aadd(arr,'Не тот профиль в услуге '+s)
  endif
endif
return fl

** 28.01.18
Function is_issled_PN(ausl,_period,arr,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s := "", fl := .f., lshifr := alltrim(ausl[1])
if (i := ascan(np_arr_not_zs,{|x| x[2] == lshifr})) > 0
  lshifr := np_arr_not_zs[i,1]
endif
for i := 1 to count_pn_arr_iss
  if np_arr_issled[i,1] == lshifr
    s := '"'+lshifr+'.'+np_arr_issled[i,3]+'"'
    if valtype(np_arr_issled[i,2]) == "C" .and. !(np_arr_issled[i,2] == _pol)
      aadd(arr,'Несовместимость по полу в услуге '+s)
    endif
    fl := .t.
    exit
  endif
next
if fl .and. np_arr_issled[i,4] < 2
  if ascan(np_arr_1_etap[_period,5],lshifr) == 0
    aadd(arr,'Некорректный возрастной период пациента для '+s)
  endif
  if valtype(np_arr_issled[i,5]) == "N" .and. np_arr_issled[i,5] != ausl[3]
    aadd(arr,'Не тот профиль в иссл-ии '+s)
  endif
endif
return fl

** 14.02.16 если услуга из 1 этапа
Function is_1_etap_PN_17(ausl,_period,_etap)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s, fl := .f., lshifr := alltrim(ausl[1])
if _etap == 2 .and. (i := ascan(np_arr_osmotr_KDP2_17,{|x| x[2] == lshifr})) > 0
  lshifr := np_arr_osmotr_KDP2_17[i,1]
endif
for i := 1 to count_pn_arr_osm_17
  if _etap == 1
    if np_arr_osmotr_17[i,4] == ausl[3]
      lshifr := np_arr_osmotr_17[i,1] // искусственно
      fl := .t. ; exit
    endif
  else
    if np_arr_osmotr_17[i,1] == lshifr
      fl := .t. ; exit
    endif
  endif
next
if fl
  fl := (ascan(np_arr_1_etap_17[_period,4],lshifr) > 0)
endif
return fl

** 14.02.16
Function is_osmotr_PN_17(ausl,_period,arr,_etap,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s, fl := .f., lshifr := alltrim(ausl[1])
if _etap == 2 .and. (i := ascan(np_arr_osmotr_KDP2_17,{|x| x[2] == lshifr})) > 0
  lshifr := np_arr_osmotr_KDP2_17[i,1]
endif
for i := 1 to count_pn_arr_osm_17
  if _etap == 1
    if np_arr_osmotr_17[i,4] == ausl[3]
      lshifr := np_arr_osmotr_17[i,1] // искусственно
      fl := .t. ; exit
    endif
  else
    if np_arr_osmotr_17[i,1] == lshifr
      fl := .t. ; exit
    endif
  endif
next
if fl
  s := '"'+lshifr+'.'+np_arr_osmotr_17[i,3]+'"'
  if _etap == 1 .and. ascan(np_arr_1_etap_17[_period,4],lshifr) == 0
    aadd(arr,'Некорректный возрастной период пациента для '+s)
  endif
  if !empty(np_arr_osmotr_17[i,2]) .and. !(np_arr_osmotr_17[i,2] == _pol)
    aadd(arr,'Несовместимость по полу в услуге '+s)
  endif
  if np_arr_osmotr_17[i,4] != ausl[3]
    aadd(arr,'Не тот профиль в услуге '+s)
  endif
endif
return fl

** 02.03.16
Function is_issled_PN_17(ausl,_period,arr,_pol)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s := "", fl := .f., lshifr := alltrim(ausl[1])
for i := 1 to count_pn_arr_iss_17
  if np_arr_issled_17[i,1] == lshifr
    s := '"'+lshifr+'.'+np_arr_issled_17[i,3]+'"'
    if valtype(np_arr_issled_17[i,2]) == "C" .and. !(np_arr_issled_17[i,2] == _pol)
      aadd(arr,'Несовместимость по полу в услуге '+s)
    endif
    fl := .t.
    exit
  endif
next
if fl .and. np_arr_issled_17[i,4] < 2
  if ascan(np_arr_1_etap_17[_period,5],lshifr) == 0
    aadd(arr,'Некорректный возрастной период пациента для '+s)
  endif
  if valtype(np_arr_issled_17[i,5]) == "N" .and. np_arr_issled_17[i,5] != ausl[3]
    aadd(arr,'Не тот профиль в иссл-ии '+s)
  endif
endif
return fl

** 20.06.19
Function is_usluga_dvn(ausl,_vozrast,arr,_etap,_pol,_spec_ter)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s, fl := .f., as, lshifr := alltrim(ausl[1]), fl_19
fl_19 := (type("is_disp_19") == "L" .and. is_disp_19)
if !fl_19 .and. ((lshifr == "2.3.3" .and. ausl[3] == 3) .or. ; // акушерскому делу
                 (lshifr == "2.3.1" .and. ausl[3] == 136))   // акушерству и гинекологии
    //.and. (i := ascan(dvn_arr_usl, {|x| valtype(x[2])=="C" .and. x[2]=="4.20.1"})) > 0
  if ((lshifr == "2.3.3" .and. eq_any(ret_old_prvs(ausl[4]),2003,2002)) .or. ;
      (lshifr == "2.3.1" .and. ret_old_prvs(ausl[4]) == 1101))
  else
    aadd(arr,'не та специальность врача в случае невозможности использования услуги:')
    aadd(arr,' "4.1.12.Осмотр акушеркой, взятие мазка (соскоба)"')
  endif
  fl := .t.
endif
if !fl
  for i := 1 to count_dvn_arr_umolch
    if dvn_arr_umolch[i,2] == lshifr
      fl := .t. ; exit
    endif
  next
endif
if !fl
  DEFAULT _spec_ter to 0
  for i := 1 to count_dvn_arr_usl
    if valtype(dvn_arr_usl[i,2]) == "C"
      if dvn_arr_usl[i,2] == "4.20.1" .and. lshifr == "4.20.2"
        fl := .t.
      elseif dvn_arr_usl[i,2] == lshifr
        fl := .t.
      endif
    endif
    if !fl .and. len(dvn_arr_usl[i]) > 11 .and. valtype(dvn_arr_usl[i,12]) == "A"
      if ascan(dvn_arr_usl[i,12],{|x| x[1] == lshifr .and. x[2] == ausl[3]}) > 0
        fl := .t.
      endif
    endif
    if fl
      s := '"'+lshifr+'.'+dvn_arr_usl[i,1]+'"'
      if eq_any(_etap,1,4,5)
        j := iif(_pol == "М", 6, 7)
        if _etap > 1 .and. len(dvn_arr_usl[i]) > 12
          j := iif(_pol == "М", 13, 14)
        endif
        if valtype(dvn_arr_usl[i,j]) == "N"
          if dvn_arr_usl[i,j] == 0
            aadd(arr,'несовместимость по полу в услуге '+s)
          endif
        else
          if ascan(dvn_arr_usl[i,j],_vozrast) == 0
            aadd(arr,'некорректный возраст пациента для услуги '+s)
          endif
        endif
      else
        j := iif(_pol == "М", 8, 9)
        if valtype(dvn_arr_usl[i,j]) == "N"
          if dvn_arr_usl[i,j] == 0
            aadd(arr,'несовместимость по полу в услуге '+s)
          endif
        elseif type("is_disp_19") == "L" .and. is_disp_19
          if ascan(dvn_arr_usl[i,j],_vozrast) == 0
            aadd(arr,'некорректный возраст пациента для услуги '+s)
          endif
        else
          if !between(_vozrast,dvn_arr_usl[i,j,1],dvn_arr_usl[i,j,2])
            aadd(arr,'некорректный возраст пациента для услуги '+s)
          endif
        endif
      endif
      if valtype(dvn_arr_usl[i,10]) == "N"
        if ret_profil_dispans(dvn_arr_usl[i,10],ausl[4]) != ausl[3]
        //if dvn_arr_usl[i,10] != ausl[3]
          aadd(arr,'не тот профиль в услуге '+s)
        endif
      else
        if ascan(dvn_arr_usl[i,10],ausl[3]) == 0
          aadd(arr,'не тот профиль в услуге '+s)
        endif
      endif
      as := aclone(dvn_arr_usl[i,11])
      // "Измерение внутриглазного давления","3.4.9"
      if _etap == 1 .and. as[1] == 1112 .and. _spec_ter > 0
        aadd(as,_spec_ter) // добавить спец-ть терапевта
      endif
      /*if ascan(as,ausl[4]) == 0
        aadd(arr,'Не та специальность врача в услуге '+s)
        aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(as))
      endif*/
      exit
    endif
  next
endif
return fl

** 18.05.15
Function is_usluga_dvn13(ausl,_vozrast,arr,_etap,_pol,_spec_ter)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s, fl := .f., as, lshifr := alltrim(ausl[1])
if ((lshifr == "2.3.3" .and. ausl[3] == 3) .or. ; // акушерскому делу
      (lshifr == "2.3.1" .and. ausl[3] == 136))   // акушерству и гинекологии
    //.and. (i := ascan(dvn_arr_usl, {|x| valtype(x[2])=="C" .and. x[2]=="4.20.1"})) > 0
  if ((lshifr == "2.3.3" .and. eq_any(ret_old_prvs(ausl[4]),2003,2002)) .or. ;
      (lshifr == "2.3.1" .and. ret_old_prvs(ausl[4]) == 1101))
  else
    aadd(arr,'Не та специальность врача в случае невозможности использования услуги:')
    aadd(arr,' "4.1.12.Осмотр акушеркой, взятие мазка (соскоба)"')
  endif
  fl := .t.
endif
if !fl
  for i := 1 to count_dvn_arr_umolch13
    if dvn_arr_umolch13[i,2] == lshifr
      fl := .t. ; exit
    endif
  next
endif
if !fl
  DEFAULT _spec_ter to 0
  for i := 1 to count_dvn_arr_usl13
    if len(dvn_arr_usl13[i]) < 12 .and. valtype(dvn_arr_usl13[i,2]) == "C"
      if dvn_arr_usl13[i,2] == "4.20.1" .and. lshifr == "4.20.2"
        fl := .t.
      elseif dvn_arr_usl13[i,2] == lshifr
        fl := .t.
      endif
    elseif len(dvn_arr_usl13[i]) > 11
      if ascan(dvn_arr_usl13[i,12],{|x| x[1]==lshifr .and. x[2]==ausl[3]}) > 0
        fl := .t.
      endif
    endif
    if fl
      s := '"'+lshifr+'.'+dvn_arr_usl13[i,1]+'"'
      if _etap == 1
        j := iif(_pol == "М", 6, 7)
        if valtype(dvn_arr_usl13[i,j]) == "N"
          if dvn_arr_usl13[i,j] == 0
            aadd(arr,'Несовместимость по полу в услуге '+s)
          endif
        else
          if ascan(dvn_arr_usl13[i,j],_vozrast) == 0
            aadd(arr,'Некорректный возраст пациента для услуги '+s)
          endif
        endif
      else
        j := iif(_pol == "М", 8, 9)
        if valtype(dvn_arr_usl13[i,j]) == "N"
          if dvn_arr_usl13[i,j] == 0
            aadd(arr,'Несовместимость по полу в услуге '+s)
          endif
        else
          if !between(_vozrast,dvn_arr_usl13[i,j,1],dvn_arr_usl13[i,j,2])
            aadd(arr,'Некорректный возраст пациента для услуги '+s)
          endif
        endif
      endif
      if valtype(dvn_arr_usl13[i,10]) == "N"
        if ret_profil_dispans(dvn_arr_usl13[i,10],ausl[4]) != ausl[3]
        //if dvn_arr_usl13[i,10] != ausl[3]
          aadd(arr,'Не тот профиль в услуге '+s)
        endif
      else
        if ascan(dvn_arr_usl13[i,10],ausl[3]) == 0
          aadd(arr,'Не тот профиль в услуге '+s)
        endif
      endif
      as := aclone(dvn_arr_usl13[i,11])
      // "Измерение внутриглазного давления","3.4.9"
      if _etap == 1 .and. as[1] == 1112 .and. _spec_ter > 0
        aadd(as,_spec_ter) // добавить спец-ть терапевта
      endif
      /*if ascan(as,ausl[4]) == 0
        aadd(arr,'Не та специальность врача в услуге '+s)
        aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(as))
      endif*/
      exit
    endif
  next
endif
return fl

** 10.05.16 является врачебным осмотром детей-сирот на первом этапе
Function is_osmotr_DDS_1_etap(ausl,_vozrast,_etap,_pol,tip_lu)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, s, fl := .f., lshifr := alltrim(ausl[1])
// вместо услуг "2.87.*" сделаем "2.83.*"
if tip_lu == TIP_LU_DDSOP .and. left(lshifr,5)=="2.87."
  lshifr := "2.83."+substr(lshifr,6)
endif
for i := 1 to count_dds_arr_osm1
  if iif(empty(dds_arr_osm1[i,2]), .t., dds_arr_osm1[i,2] == mpol) .and. ;
                           between(_vozrast,dds_arr_osm1[i,3],dds_arr_osm1[i,4])
    if _etap == 1
      if ascan(dds_arr_osm1[i,5],ausl[3]) > 0
        fl := .t. ; exit
      endif
    else
      if ascan(dds_arr_osm1[i,7],lshifr) > 0
        fl := .t. ; exit
      endif
    endif
  endif
next
return fl

** 13.02.17 является врачебным осмотром детей-сирот
Function is_osmotr_DDS(ausl,_vozrast,arr,_etap,_pol,tip_lu)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
Local i, j, s, fl := .f., lshifr := alltrim(ausl[1])
// вместо услуг "2.87.*" сделаем "2.83.*"
if tip_lu == TIP_LU_DDSOP .and. left(lshifr,5)=="2.87."
  lshifr := "2.83."+substr(lshifr,6)
endif
if _etap == 2 .and. (j := ascan(dds_arr_osmotr_KDP2,{|x| x[2] == lshifr})) > 0
  lshifr := dds_arr_osmotr_KDP2[j,1]
endif
for i := 1 to count_dds_arr_osm1
  if _etap == 1
    if ascan(dds_arr_osm1[i,5],ausl[3]) > 0
      fl := .t. ; exit
    endif
  else
    if ascan(dds_arr_osm1[i,7],lshifr) > 0
      fl := .t. ; exit
    endif
  endif
next
if fl
  s := '"'+lshifr+'.'+dds_arr_osm1[i,1]+'"'
  /*if !between(_vozrast,dds_arr_osm1[i,3],dds_arr_osm1[i,4])
    aadd(arr,'Некорректный возраст пациента для услуги '+s)
  endif*/
  if !empty(dds_arr_osm1[i,2]) .and. !(dds_arr_osm1[i,2] == _pol)
    aadd(arr,'Несовместимость по полу в услуге '+s)
  endif
  if ascan(dds_arr_osm1[i,5],ausl[3]) == 0
    aadd(arr,'Не тот профиль в услуге '+s)
  endif
  /*if ascan(dds_arr_osm1[i,6],ausl[4]) == 0
    aadd(arr,'Не та специальность врача в услуге '+s)
    aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(dds_arr_osm1[i,6]))
  endif*/
endif
if !fl .and. _etap == 2
  for i := 1 to count_dds_arr_osm2
    if ascan(dds_arr_osm2[i,7],lshifr) > 0 .and. ascan(dds_arr_osm2[i,5],ausl[3]) > 0
      fl := .t. ; exit
    endif
  next
  if fl
    s := '"'+lshifr+'.'+dds_arr_osm2[i,1]+'"'
    if !between(_vozrast,dds_arr_osm2[i,3],dds_arr_osm2[i,4])
      aadd(arr,'Некорректный возраст пациента для услуги '+s)
    endif
    if ascan(dds_arr_osm2[i,5],ausl[3]) == 0
      aadd(arr,'Не тот профиль в услуге '+s)
    endif
    /*if ascan(dds_arr_osm2[i,6],ausl[4]) == 0
      aadd(arr,'Не та специальность врача в услуге '+s)
      aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(dds_arr_osm2[i,6]))
    endif*/
  endif
endif
return fl

** 13.05.13 является исследованием детей-сирот
Function is_issl_DDS(ausl,_vozrast,arr)
// ausl := {lshifr,mdate,hu_->profil,hu_->PRVS}
  Local i, s, fl := .f., lshifr := alltrim(ausl[1])

  for i := 1 to count_dds_arr_iss
    if ascan(dds_arr_iss[i,7],lshifr) > 0
      fl := .t. ; exit
    endif
  next
  if fl .and. valtype(_vozrast) == "N"
    s := '"'+lshifr+'.'+dds_arr_iss[i,1]+'"'
    if !between(_vozrast,dds_arr_iss[i,3],dds_arr_iss[i,4])
      aadd(arr,'Некорректный возраст пациента для услуги '+s)
    endif
    if ascan(dds_arr_iss[i,5],ausl[3]) == 0
      aadd(arr,'Не тот профиль в услуге '+s)
    endif
    /*if ascan(dds_arr_iss[i,6],ausl[4]) == 0
      aadd(arr,'Не та специальность врача в услуге '+s)
      aadd(arr,' у Вас: '+lstr(ausl[4])+', разрешено: '+print_array(dds_arr_iss[i,6]))
    endif*/
  endif
  return fl

// инициализация прочих справочников
// Function InitSpravOthers()
// /////////////////////////////////////////////////
// // glob_katl - Классификатор кодов льгот по ДЛО
// //  1 - NAME(C)  2 - KOD(C)
//   Public glob_katl := {}

//   aadd(glob_katl, {"000 --- без льготы ---","   "})
//   aadd(glob_katl, {"010 Инвалиды войны","010"})
//   aadd(glob_katl, {"011 Участники Великой Отечественной войны, ставшие инвалидами","011"})
//   aadd(glob_katl, {"012 Военнослужащие органов внутренних дел, Государственной противопожарной службы, учреждений и органов уголовно-исполнительной системы, ставших инвалидами вследствие ранения, контузии или увечья, полученных при исполнении обязанностей военной службы","012"})
//   aadd(glob_katl, {"020 Участники Великой Отечественной войны","020"})
//   aadd(glob_katl, {"030 Ветераны боевых действий","030"})
//   aadd(glob_katl, {"040 Военнослужащие, проходившие военную службу в воинских частях, не входивших в состав действующей армии, в период с 22 июня 1941 года по 3 сентября 1945 года не менее шести месяцев, военнослужащие, награжденные орденами или медалями СССР","040"})
//   aadd(glob_katl, {'050 Лица, награжденные знаком "Жителю блокадного Ленинграда"',"050"})
//   aadd(glob_katl, {"060 Члены семей погибших (умерших) инвалидов войны, участников Великой Отечественной войны и ветеранов боевых действий","060"})
//   aadd(glob_katl, {"061 Члены семей погибших в Великой Отечественной войне лиц из числа личного состава групп самозащиты объектовых и аварийных команд местной противовоздушной обороны, а также члены семей погибших работников госпиталей и больниц города Ленинграда","061"})
//   aadd(glob_katl, {"062 Члены семей военнослужащих органов внутренних дел, Государственной противопожарной службы, учреждений и органов уголовно-исполнительной системы и органов государственной безопасности, погибших при исполнении обязанностей военной службы","062"})
//   aadd(glob_katl, {"063 Члены семей военнослужащих, погибших в плену, признанных в установленном порядке пропавшими без вести в районах боевых действий","063"})
//   aadd(glob_katl, {"081 Инвалиды I степени","081"})
//   aadd(glob_katl, {"082 Инвалиды II степени","082"})
//   aadd(glob_katl, {"083 Инвалиды III степени","083"})
//   aadd(glob_katl, {"084 Дети-инвалиды","084"})
//   aadd(glob_katl, {"085 Инвалиды, не имеющие степени ограничения способности к трудовой деятельности","085"})
//   aadd(glob_katl, {"091 Граждане, получившие или перенесшие лучевую болезнь и другие заболевания, связанные с радиационным воздействием вследствие чернобыльской катастрофы или с работами по ликвидации последствий катастрофы на Чернобыльской АЭС","091"})
//   aadd(glob_katl, {"092 Инвалиды вследствие чернобыльской катастрофы","092"})
//   aadd(glob_katl, {"093 Граждане, принимавшие в 1986-1987 годах участие в работах по ликвидации последствий чернобыльской катастрофы","093"})
//   aadd(glob_katl, {"094 Граждане, принимавшие участие в 1988-90гг. участие в работах по ликвидации последствий чернобыльской катастрофы","094"})
//   aadd(glob_katl, {"095 Граждане, постоянно проживающие (работающие) на территории зоны проживания с правом на отселение","095"})
//   aadd(glob_katl, {"096 Граждане, постоянно проживающие (работающие) на территории зоны проживания с льготным социально-экономическим статусом","096"})
//   aadd(glob_katl, {"097 Граждане, постоянно проживающие (работающие) в зоне отселения до их переселения в другие районы","097"})
//   aadd(glob_katl, {"098 Граждане, эвакуированные (в том числе выехавшие добровольно) в 1986 году из зоны отчуждения","098"})
//   aadd(glob_katl, {"099 Дети и подростки в возрасте до 18 лет, проживающие в зоне отселения и зоне проживания с правом на отселение, эвакуированные и переселенные из зон отчуждения, отселения, проживания с правом на отселение","099"})
//   aadd(glob_katl, {"100 Дети и подростки в возрасте до 18 лет, постоянно проживающие в зоне с льготным социально-экономическим статусом","100"})
//   aadd(glob_katl, {"101 Дети и подростки, страдающие болезнями вследствие чернобыльской катастрофы, ставшие инвалидами","101"})
//   aadd(glob_katl, {"102 Дети и подростки, страдающие болезнями вследствие чернобыльской катастрофы","102"})
//   aadd(glob_katl, {"111 Граждане, получившие суммарную (накопительную) эффективную дозу облучения, превышающую 25 сЗв (бэр)","111"})
//   aadd(glob_katl, {"112 Граждане, получившие суммарную (накопительную) эффективную дозу облучения более 5 сЗв (бэр), но не превышающую 25 сЗв (бэр)","112"})
//   aadd(glob_katl, {"113 Дети в возрасте до 18 лет первого и второго поколения граждан, получившие суммарную (накопительную) эффективную дозу облучения более 5 сЗв (бэр), страдающих заболеваниями вследствие радиационного воздействия на одного из родителей","113"})
//   aadd(glob_katl, {"120 Лица, работавшие в период Великой Отечественной войны на объектах противовоздушной обороны, на строительстве оборонительных сооружений, военно-морских баз, аэродромов и других военных объектов","120"})
//   aadd(glob_katl, {'121 Граждане, получившие лучевую болезнь, обусловленную воздействием радиации вследствие аварии в 1957 году на производственном объединении "Маяк" и сбросов радиоактивных отходов в реку Теча',"121"})
//   aadd(glob_katl, {'122 Граждане, ставшие инвалидами в результате воздействия радиации вследствие аварии в 1957 году на производственном объединении "Маяк" и сбросов радиоактивных отходов в реку Теча',"122"})
//   aadd(glob_katl, {'123 Граждане, принимавшие в 1957-58гг. участие в работах по ликвидации последствий аварии в 1957 году на производственном объединении "Маяк", а также граждане, занятые на работах по проведению мероприятий вдоль реки Теча в 1949-56гг.',"123"})
//   aadd(glob_katl, {'124 Граждане, принимавшие в 1959-61гг. участие в работах по ликвидации последствий аварии в 1957 году на производственном объединении "Маяк", а также граждане, занятые на работах по проведению мероприятий вдоль реки Теча в 1957-62гг.',"124"})
//   aadd(glob_katl, {'125 Граждане, проживающие в населенных пунктах, подвергшихся радиоактивному загрязнению вследствие аварии в 1957 году на производственном объединении "Маяк" и сбросов радиоактивных отходов в реку Теча',"125"})
//   aadd(glob_katl, {'128 Граждане, эвакуированные из населенных пунктов, подвергшихся радиоактивному загрязнению вследствие аварии в 1957 году на производственном объединении "Маяк" и сбросов радиоактивных отходов в реку Теча',"128"})
//   aadd(glob_katl, {"129 Дети первого и второго поколения граждан, указанных в статье 1 Федерального закона от 26.11.98 № 175-ФЗ, страдающие заболеваниями вследствие воздействия радиации на их родителей","129"})
//   aadd(glob_katl, {"131 Граждане из подразделений особого риска, не имеющие инвалидности","131"})
//   aadd(glob_katl, {"132 Граждане из подразделений особого риска, имеющие инвалидность","132"})
//   aadd(glob_katl, {"140 Бывшие несовершеннолетние узники концлагерей, признанные инвалидами вследствие общего заболевания, трудового увечья и других причин (за исключением лиц, инвалидность которых наступила вследствие их противоправных действий)","140"})
//   aadd(glob_katl, {"141 Рабочие и служащие, а также военнослужащих органов внутренних дел, Государственной противопожарной службы, получившие профессиональные заболевания, связанные с лучевым воздействием на работах в зоне отчуждения","141"})
//   aadd(glob_katl, {"142 Рабочие и служащие, а также военнослужащие органов внутренних дел, Государственной противопожарной службы, получивших профессиональные заболевания, связанные с лучевым воздействием на работах в зоне отчуждения, ставшие инвалидами","142"})
//   aadd(glob_katl, {"150 Бывшие несовершеннолетние узники концлагерей","150"})
//   return NIL


// 29.12.21 вернуть код план-заказа по методу ВМП
Function ret_PZ_VMP(lunit, kDate)
  Local mpztip := 0
  local sbase, nYear := WORK_YEAR

  hb_default( @kDate, WORK_YEAR )

  if valtype(kDate) == 'D'
    nYear := year(kDate)
  elseif valtype(kDate) == 'N' .and. kDate >= 2018
    nYear := kDate
  endif

  if select('MOUNIT') == 0
    sbase := prefixFileRefName(nYear) + 'unit'
    R_Use(dir_exe + sbase, cur_dir + sbase, 'MOUNIT')
  endif
  select MOUNIT
  find (str(lunit, 3))
  if found() .and. mounit->pz > 0
    mpztip := mounit->pz
  endif
  return mpztip